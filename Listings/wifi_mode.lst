C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE WIFI_MODE
OBJECT MODULE PLACED IN .\Objects\wifi_mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE source\wifi_mode.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\
                    -include) DEBUG OBJECTEXTEND PRINT(.\Listings\wifi_mode.lst) OBJECT(.\Objects\wifi_mode.obj)

line level    source

   1          //Í·ÎÄ¼şheader file//
   2          #include "app_main.h"
   3          
   4          
   5          uint8_t  code Week_Table[]={0x01,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};
   6          
   7          char  code SPASongs_Num_Table[7][24]= 
   8          {
   9                  "$$${MusicStatus:[07]}\r\n",
  10                  "$$${MusicStatus:[01]}\r\n",
  11                  "$$${MusicStatus:[02]}\r\n",
  12                  "$$${MusicStatus:[03]}\r\n",
  13                  "$$${MusicStatus:[04]}\r\n",
  14                  "$$${MusicStatus:[05]}\r\n",
  15                  "$$${MusicStatus:[06]}\r\n",
  16          };
  17          
  18          //º¯ÊıÉùÃ÷Function declaration//
  19          void Program1_LaterNum();
  20          
  21          uint8_t char_compare( char *source,  char *dest)
  22          {
  23   1              while(*dest)
  24   1              {       
  25   2                      if((*source!=*dest)||(*source==0)||(*dest==0))
  26   2                              return 1;
  27   2                      source++;
  28   2                      dest++;
  29   2              }
  30   1              return 0;
  31   1      }
  32          
  33          char char_to_hex(char indata1,char indata2)
  34          {
  35   1              if(indata1>='A')
  36   1                      indata1=((indata1-'A')+0x0A);
  37   1              else
  38   1                      indata1=(indata1-'0');
  39   1              if(indata2>='A')
  40   1                      indata2=((indata2-'A')+0x0A);
  41   1              else
  42   1                      indata2=(indata2-'0');
  43   1              return ((indata1<<4)|indata2);
  44   1      }
  45          char char_to_bcd(char indata1,char indata2)
  46          {
  47   1              if(indata1>='A')
  48   1                      indata1=((indata1-'A')+0x0A);
  49   1              else
  50   1                      indata1=(indata1-'0');
  51   1              if(indata2>='A')
  52   1                      indata2=((indata2-'A')+0x0A);
  53   1              else
  54   1                      indata2=(indata2-'0');
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 2   

  55   1              return (indata1*10+indata2);
  56   1      }
  57          
  58          
  59          void hex_to_char(uint8_t *p,uint8_t indata)
  60          {
  61   1              uint8_t tmp;
  62   1              tmp=indata>>4;
  63   1              if(tmp>=0x0A)
  64   1               *p=((tmp-0x0A)+'A'); 
  65   1              else
  66   1               *p=(tmp+'0');
  67   1              p++;
  68   1              tmp=indata&0x0F;
  69   1              if(tmp>=0x0A)
  70   1                      *p=((tmp-0x0A)+'A'); 
  71   1              else
  72   1                      *p=(tmp+'0');
  73   1      }
  74          
  75          void GP389_ON(void) //
  76          {
  77   1              PlayMode=PLAY_ON;
  78   1              PlayMode=((PlayMode_bk==PLAY_MUSIC)?PLAY_MUSIC:PLAY_ON);//Èç¹û¹Ø»úÊ±ÊÇmusicÄ£Ê½£¬¿ª»ú»Ø¸´´ËÄ£Ê½
  79   1              sys_volume=sys_volume_bk;
  80   1              color_mode=color_mode_bk;
  81   1              //Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);//¹Ø»úÖ®Ç°Èç¹ûÁÁ¶ÈÎª0¾Í»Ö¸´Îª1£¬·ñÔòÎª¹Ø»úÖ
             -®Ç°ÁÁ¶È//2018.4.9¹Ø»úÖ®Ç°ÁÁ¶ÈÎª0£¬¿ª»úÒ²Îª0
  82   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
  83   1              
  84   1              Uart0_SendString_3Step=3;
  85   1      }
  86          void GP389_ON_APP(void) //
  87          {
  88   1              PlayMode=PLAY_ON;
  89   1              sys_volume=sys_volume_bk;
  90   1              //Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);//¹Ø»úÖ®Ç°Èç¹ûÁÁ¶ÈÎª0¾Í»Ö¸´Îª1£¬·ñÔòÎª¹Ø»úÖ
             -®Ç°ÁÁ¶È//2018.4.9¹Ø»úÖ®Ç°ÁÁ¶ÈÎª0£¬¿ª»úÒ²Îª0
  91   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
  92   1              Uart0_SendString_3Step=3;
  93   1      }
  94          void GP389_OFF(void) //
  95          {
  96   1              PlayMode_bk=PlayMode;
  97   1              PlayMode=PLAY_OFF;
  98   1              sys_volume_bk=sys_volume;
  99   1              color_mode_bk=color_mode;
 100   1              color_mode=COLOR_OFF;
 101   1              TimerMode=cntTimer=TIMER_OFF;//
 102   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 103   1              Uart0_SendString_3Step=3;
 104   1      }
 105          void GP389_OFF_AND_AlarmOFF()
 106          {//ÄÖÖÓÔÚÏìÓ¦Ê±²Ù×÷ÔÚAPPÉÏµ÷ÁËµÆ¹âÁÁ¶È£¬ÒôÁ¿´óĞ¡£¬Ôò¹Ø±ÕÄÖÁå²¢¹Ø»ú£¬ÔÚappÉÏµãÁËÌØ¶¨
 107   1       //ÑÕÉ«µÄµÆ¹â£¬»òÕßµãÁËÌØ¶¨ÒôÀÖ£¬»òÕßµãÁËprogram,ÄÇÃ´ÄÖÖÓÍ£Ö¹£¬ÏìÓ¦ËùµãµÄ²Ù×÷
 108   1              alarm.Runing=0;
 109   1              gbKeyNone=0;
 110   1              GP389_OFF();
 111   1              //color_mode=COLOR_OFF;
 112   1              Uart0_SendString_3Step=5;
 113   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);       
 114   1              TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF;    
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 3   

 115   1              return;
 116   1      }
 117          
 118          void ApplicationGP389_ONOFF(uint8_t onoff)//ÉêÇë¿ª¹Ø»úÊ±µ÷ÓÃ´Ëº¯Êı
 119          {//$$${GpSta:[00,00,01,01,FFFFFF,03,0A,00,1E;00,01,00,FFFFFF,03,0A,01,FF,17:3B,FF]}\r\n
 120   1       //Êı×éÖĞµÚÊı¾İÒÔ¶ººÅ·Ö¸ô£¬Êı×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ğ´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨Ç°10¸ö×Ö¶Î£©·Ö±ğ±íÊ¾£
             -º
 121   1       //¡·ÊÇ·ñ¹Ø»ú,00ÊÇ¿ª»ú£¬01ÊÇ¹Ø»ú
 122   1       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 123   1       //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 124   1       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 125   1       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 126   1       //¡·´ú±íÁÁ¶È( 00 - 03 )
 127   1       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0A )
 128   1       //¡·´ú±íÔİÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õı³£²¥·Å,01±íÊ¾ÔİÍ£²¥·Å£©
 129   1       //¡·´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 130   1       //¡·Ó¢ÎÄ·ÖºÅ¡°;¡±¸ô¿ªÕâÁ½²¿·ÖÃüÁî
 131   1       //¡·ÄÖÖÓ¿ØÖÆĞÅÏ¢£ºÊı×éÖĞµÚÊı¾İÒÔ¶ººÅ·Ö¸ô£¬Êı×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ğ´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨10¸ö×
             -Ö¶Î£©·Ö±ğ±íÊ¾£º
 132   1       //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓĞÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 133   1       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 134   1       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 135   1       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 136   1       //¡·´ú±íÁÁ¶È( 00 - 03 )
 137   1       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 138   1       //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 139   1       //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 140   1       //  0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 141   1       //  0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 142   1       //  0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 143   1       //  BIT            7       6    5    4    3    2    1    0
 144   1       //  ĞÇÆÚx   repeat  ÈÕ  Áù  Îå  ËÄ  Èı  ¶ş  Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î£¬ÕâÒ»´Î
 145   1       //  ÊÇÆßÌìÖ®ÄÚµÄ£¬¼ÙÈç¶¨Ê±13:00£¬²»ÖØ¸´£¬ÄÇÕâ´Î¼ÆÊ±µ½(7*24*60-1)minÖ®ºó½áÊø£¬¼´ÆßÌìÖ®ºó
 146   1       //  µÄ12:59·Ö£©
 147   1       //¡·´ú±íÄÖÖÓÊ±¼ä£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 148   1       //¡·´ú±íÏìÁåÊ±¼ä£¨charÀàĞÍ1¸ö×Ö½Ú£©00-FF (µ¥Î»:·ÖÖÓ)
 149   1              char i;
 150   1              char code respGP389_AllSta[]={"$$${GpSta:[00,00,00,00,000000,00,00,00,00;00,00,00,000000,00,00,00,00,00:0
             -0,00]}\r\n"};
 151   1              do{WDT_clear();} while(Uart0_EnableSend);
 152   1              Count200ms_3Step=0;
 153   1              //Uart0_SendString_3Step=0;
 154   1              for(i=0;i<UART0_LEN_BUFFER;i++)
 155   1                      Uart0_TransmitBuffer[i]=0x00;
 156   1              for(i=0;i<82;i++)
 157   1                      Uart0_TransmitBuffer[i]=respGP389_AllSta[i];
 158   1              hex_to_char(&Uart0_TransmitBuffer[11],onoff);
 159   1              hex_to_char(&Uart0_TransmitBuffer[14],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅĞ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹û
             -ÊÇ£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔİÍ££¬7
 160   1              hex_to_char(&Uart0_TransmitBuffer[17],((color_mode==COLOR_OFF)?0:1));//Îª1Ê±ÊÇÒª¹Ø»ú£¬ËùÒÔÒªºÍcolor_mode_
             -bk¶Ô±È£¬Îª0ÊÇÒª¿ª»ú£¬ÒÑ¾­°Ñcolor_mode_bk¸³Öµ¸øcolor_mode
 161   1              hex_to_char(&Uart0_TransmitBuffer[20],((color_mode==COLOR_CHANGE)?1:0));
 162   1              hex_to_char(&Uart0_TransmitBuffer[23],userR_val);
 163   1              hex_to_char(&Uart0_TransmitBuffer[25],userG_val);       
 164   1              hex_to_char(&Uart0_TransmitBuffer[27],userB_val);
 165   1              hex_to_char(&Uart0_TransmitBuffer[30],Light_Brightness);
 166   1              hex_to_char(&Uart0_TransmitBuffer[33],sys_volume);
 167   1              hex_to_char(&Uart0_TransmitBuffer[36],enable_SPApause);
 168   1              hex_to_char(&Uart0_TransmitBuffer[39],cntTimer);
 169   1              hex_to_char(&Uart0_TransmitBuffer[42],00);//ÄÖÖÓIDºÅÄ¬ÈÏÎª0
 170   1              hex_to_char(&Uart0_TransmitBuffer[45],alarm.spa_name);//Ê×ÏÈÅĞ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²
             -»ÊÇ¾Í·µ»ØÔİÍ££¬7
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 4   

 171   1              hex_to_char(&Uart0_TransmitBuffer[48],((alarm.color_mode==COLOR_CHANGE)?1:0));//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ
             -£Ê½£©
 172   1              hex_to_char(&Uart0_TransmitBuffer[51],alarm.userR_val);
 173   1              hex_to_char(&Uart0_TransmitBuffer[53],alarm.userG_val); 
 174   1              hex_to_char(&Uart0_TransmitBuffer[55],alarm.userB_val);
 175   1              hex_to_char(&Uart0_TransmitBuffer[58],alarm.Brightness);//ÁÁ¶È
 176   1              hex_to_char(&Uart0_TransmitBuffer[61],alarm.volume);//ÒôÁ¿
 177   1              hex_to_char(&Uart0_TransmitBuffer[64],alarm.Enable); //ÄÖÖÓ×Ü¿ª¹Ø
 178   1              hex_to_char(&Uart0_TransmitBuffer[67],alarm.Week);  //ÄÖÖÓÖÜ¼¸ÏìµÍ4Î»
 179   1              hex_to_char(&Uart0_TransmitBuffer[70],alarm.Hour);  //ÄÖÖÓ¶¨Ê±µÄÊ±¼ä£¬Ğ¡Ê±µÍËÄÎ»
 180   1              hex_to_char(&Uart0_TransmitBuffer[73],alarm.Minute);//ÄÖÖÓ¶¨Ê±µÄÊ±¼ä£¬·ÖÖÓµÍËÄÎ»
 181   1              hex_to_char(&Uart0_TransmitBuffer[76],alarm.Duration);//ÄÖÖÓÏìÁåÊ±¼ä£¬µÍËÄÎ»
 182   1              Uart0_SendString_3Step=2;
 183   1              Uart0_Tx_Pointer=0;
 184   1              Uart0_EnableSend=1;
 185   1              Uart0_Tx_TimeOut=10;    
 186   1              USI0DR=Uart0_TransmitBuffer[Uart0_Tx_Pointer++];
 187   1              if(cntFlag_ON_OFF==0)
 188   1                      cntFlag_ON_OFF=2;
 189   1      }
 190          
 191          uint8_t xxxxxx;
 192          void Wifi_CommandDeal(char *Uart0_Receive)
 193          {
 194   1              uint8_t i;
 195   1              char *WIFI_CMD;
 196   1              WIFI_CMD=&Uart0_Receive[3];
 197   1              if(char_compare(WIFI_CMD,"{AlarmSet")==0)//ok
 198   1              {//$$${AlarmSet:[00,01,00,01,FFFFFF,03,0A,00,00,FF,17:3B,FF,0a/20/00/12/01/01/02]}\r\n
 199   2               //Êı×éÖĞµÚÊı¾İÒÔ¶ººÅ·Ö¸ô£¬Êı×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ğ´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨10¸ö×Ö¶Î£©·Ö±ğ±íÊ¾£º
 200   2               //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓĞÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 201   2               //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 202   2               //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 203   2               //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·,£©
 204   2               //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 205   2               //¡·£¨È¥µô£©´ú±íµÆÑÕÉ«µÄÏÂ±ê£¬Óëapp½çÃæÖĞµÆÒ»ÖÂ£¬·½±ãµÆ×´Ì¬Í¬²½ÔÆ¶ËºÍapp£¨00-0B£©,ÆäÖĞ00´ú±í¹ØµÆ£¬0A´ú±í
             -²ÊµÆ£¬0B´ú±í×Ô¶¨ÒåÑÕÉ«
 206   2               //¡·´ú±íÁÁ¶È( 00 - 03 )
 207   2               //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 208   2               //¡·´ú±íÔİÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õı³£²¥·Å,01±íÊ¾ÔİÍ£²¥·Å£©
 209   2               //¡·(È¥µô)£º´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 210   2               //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 211   2               //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 212   2               //  0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 213   2               //  0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 214   2               //  0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 215   2               //  BIT      7       6    5    4    3    2    1    0
 216   2               //  ĞÇÆÚx  repeat    ÈÕ   Áù   Îå    ËÄ   Èı   ¶ş   Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î
 217   2               //¡·´ú±íÄÖÖÓ¶¨Ê±Ê±¼äµã£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 218   2               //¡·´ú±íÏìÁåÊ±¼ä£¨intÀàĞÍ4¸ö×Ö½Ú£©00-FF (µ¥Î»ÓÉÇ¿´ó¶¨Òå)
 219   2               //¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ğ°´ÕÕÊ®Áù½øÖÆÊı¼ÓĞ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ĞÇÆÚ£©
 220   2               //  ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëĞÇÆÚ¶ş ÄÇÃ´¸ñÊ½ÊÇ 0a/20/00/12/01/01/02
 221   2               //(WIFI_CMD[11]-'0')  //ProgrammaµÄIDºÅÔİÊ±Ã»ÓĞ£¬ÎªÒÔºóÀ©Õ¹Ô¤±¸   
 222   2                      alarm.spa_name  =(WIFI_CMD[15]-'0');//µÚ¼¸Ê×¸è
 223   2                      if(alarm.spa_name>=7)
 224   2                              alarm.spa_name=0;
 225   2                      alarm.color_mode=(WIFI_CMD[18]-'0');//µÆ¹âµÄ¿ª¹Ø
 226   2                      alarm.color_mode=(WIFI_CMD[18]=='1')?((WIFI_CMD[21]=='1')?COLOR_CHANGE:COLOR_USER):COLOR_OFF;
 227   2                      alarm.userR_val=char_to_hex(WIFI_CMD[23],WIFI_CMD[24]);//RÖµ  
 228   2                      alarm.userG_val=char_to_hex(WIFI_CMD[25],WIFI_CMD[26]);//GÖµ  
 229   2                      alarm.userB_val=char_to_hex(WIFI_CMD[27],WIFI_CMD[28]);//BÖµ  
 230   2                      alarm.Brightness=(WIFI_CMD[31]-'0');//ÁÁ¶È
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 5   

 231   2                      alarm.volume=char_to_hex(WIFI_CMD[33],WIFI_CMD[34]);//ÒôÁ¿
 232   2                      alarm.play_pause=WIFI_CMD[37]-'0';//ÔİÍ£²¥·Å
 233   2                      alarm.Enable=(WIFI_CMD[40]-'0');//ÄÖÖÓ×Ü¿ª¹Ø
 234   2                      alarm.Week=char_to_hex(WIFI_CMD[42],WIFI_CMD[43]); 
 235   2                      alarm.Hour=char_to_hex(WIFI_CMD[45],WIFI_CMD[46]);   //ÄÖÖÓÏìµÄĞ¡Ê±µã
 236   2                      alarm.Minute=char_to_hex(WIFI_CMD[48],WIFI_CMD[49]); 
 237   2                      alarm.Duration=char_to_hex(WIFI_CMD[51],WIFI_CMD[52]);//³ÖĞøÏìÁåÊ±¼ä£¬×ª»¯ÎªÊıÖµ
 238   2                      IE3 &= ~0x04;           // Enable WT interrupt
 239   2                      gRTC_Hour  =char_to_hex(WIFI_CMD[54],WIFI_CMD[55]);
 240   2                      gRTC_Minute=char_to_hex(WIFI_CMD[57],WIFI_CMD[58]);
 241   2                      gRTC_Sec   =char_to_hex(WIFI_CMD[60],WIFI_CMD[61]);
 242   2                      gRTC_Week  =WIFI_CMD[73]-'0';
 243   2                      gRTC_Week=Week_Table[gRTC_Week];
 244   2                      IE3 |= 0x04;            // Enable WT interrupt
 245   2                      if((alarm.Enable)&&(!(alarm.Week&0x7F)))
 246   2                       Flag_alarm_wake_only=1;
 247   2                      else
 248   2                       Flag_alarm_wake_only=0;
 249   2              }
 250   1              else if(char_compare(WIFI_CMD,"{AlarmOnOff")==0)
 251   1              {//$$${AlarmOnOff:[00,00,10/21/33/12/01/1D/01]}\r\n
 252   2               //¡·´ú±í Alarm µÄ ID ºÅ 
 253   2               //¡·´ú±íÄÖÖÓµÄ¿ª¹Ø
 254   2               //¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ğ°´ÕÕÊ®Áù½øÖÆÊı¼ÓĞ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ĞÇÆÚ£©
 255   2               //      ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëĞÇÆÚ¶ş ÄÇÃ´¸ñÊ½ÊÇ  0a/20/00/12/01/01/02
 256   2               //(WIFI_CMD[11]-'0')  //ProgrammaµÄIDºÅÔİÊ±Ã»ÓĞ£¬ÎªÒÔºóÀ©Õ¹Ô¤±¸   
 257   2                      alarm.Enable=(WIFI_CMD[17]-'0'); 
 258   2                      IE3 &= ~0x04;           // Enable WT interrupt
 259   2                      gRTC_Hour    =char_to_hex(WIFI_CMD[19],WIFI_CMD[20]);
 260   2                      gRTC_Minute  =char_to_hex(WIFI_CMD[22],WIFI_CMD[23]);
 261   2                      gRTC_Sec     =char_to_hex(WIFI_CMD[25],WIFI_CMD[26]);
 262   2                      gRTC_Week    =WIFI_CMD[38]-'0';
 263   2                      gRTC_Week=Week_Table[gRTC_Week];
 264   2                      IE3 |= 0x04;            // Enable WT interrupt
 265   2                      if((alarm.Enable)&&(!(alarm.Week&0x7F)))
 266   2                       Flag_alarm_wake_only=1;
 267   2                      else
 268   2                       Flag_alarm_wake_only=0;
 269   2              }
 270   1                      else if(char_compare(WIFI_CMD, "Turn on unit")==0) 
 271   1                      {//$$$Turn on unit\r\n
 272   2                              Uart0Transmit_SendString(Uart0_Receive);
 273   2                              if(PlayMode==PLAY_OFF)
 274   2                              {
 275   3                                      GP389_ON();     
 276   3                                      //ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 277   3                                      return;
 278   3                              }
 279   2                      }
 280   1                      else if(char_compare(WIFI_CMD, "Turn on Lightr")==0)
 281   1                      {//$$$Turn on Lightr\r\n
 282   2                              Uart0Transmit_SendString(Uart0_Receive);
 283   2                              if(PlayMode==PLAY_OFF)
 284   2                                      GP389_ON_APP(); 
 285   2                              if(alarm.Runing)//Õâ¸öÒ»¶¨ÊÇ¿ª»ú×´Ì¬²Å½øÈ¥
 286   2                              {
 287   3                                      alarm.Runing=0;
 288   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 289   3                              }
 290   2                              color_mode=color_mode_bk;
 291   2                              if(color_mode==COLOR_OFF)
 292   2                                      color_mode=COLOR_WHITE;
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 6   

 293   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 294   2                              return;
 295   2                      }
 296   1                      else if(char_compare(WIFI_CMD, "Change light color")==0)  
 297   1                      {//$$$Change light color Allplay\r\n
 298   2                              Uart0Transmit_SendString(Uart0_Receive);
 299   2                              if(PlayMode==PLAY_OFF)
 300   2                                      GP389_ON_APP();
 301   2                              if(alarm.Runing)
 302   2                              {//Õâ¸öÒ»¶¨ÊÇ¿ª»úÇé¿öÏÂ½øÈëµÄ
 303   3                                      alarm.Runing=0;
 304   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 305   3                              }
 306   2                              color_mode=COLOR_CHANGE;
 307   2                              play_rgb_index=0;
 308   2                              curR_val=0;
 309   2                              curG_val=0;
 310   2                              curB_val=0;
 311   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 312   2                              return;
 313   2                      } 
 314   1                      else if(char_compare(WIFI_CMD, "User color")==0) 
 315   1                      {//$$$User color FFFFFF\r\n(000000-FFFFFF)
 316   2                              Uart0Transmit_SendString(Uart0_Receive);
 317   2                              if(PlayMode==PLAY_OFF)
 318   2                                      GP389_ON_APP();
 319   2                              if(alarm.Runing)
 320   2                              {
 321   3                                      alarm.Runing=0;
 322   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 323   3                              }
 324   2                              userR_val=char_to_hex(WIFI_CMD[11],WIFI_CMD[12]);
 325   2                              userG_val=char_to_hex(WIFI_CMD[13],WIFI_CMD[14]);
 326   2                              userB_val=char_to_hex(WIFI_CMD[15],WIFI_CMD[16]);
 327   2                              color_mode=COLOR_USER;
 328   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 329   2                              return;
 330   2                      }
 331   1                      else if(char_compare(WIFI_CMD, "Select Sound file")==0) 
 332   1                      {//$$$Select Sound file to play01\r\n
 333   2                              Uart0Transmit_SendString(Uart0_Receive);
 334   2                              if(PlayMode==PLAY_OFF)
 335   2                                      GP389_ON_APP();
 336   2                              if(alarm.Runing)
 337   2                              {
 338   3                                      alarm.Runing=0;
 339   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 340   3                              }
 341   2                              enableMute=0;//½âmute
 342   2                              enable_SPApause=0;
 343   2                              PlayMode=PLAY_MUSIC;
 344   2                              spa_name=WIFI_CMD[26]-'0';
 345   2                              if(cur_spa_name==spa_name)
 346   2                                      spa_cmd=SPA_PALY;
 347   2                              Uart0_SendString_3Step=1;
 348   2                              Uart0Transmit_SendString(&SPASongs_Num_Table[spa_name][0]);//Ã¿´Î¸ü¸ÄÒôÀÖ¾Í·¢¸øappÍ¬²½
 349   2                              return;
 350   2                      }
 351   1                      else if(char_compare(WIFI_CMD, "music play")==0)
 352   1                      {//$$$music play\r\n
 353   2                              //Uart0Transmit_SendString(Uart0_Receive);
 354   2                              if(PlayMode==PLAY_OFF)
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 7   

 355   2                                      GP389_ON_APP();
 356   2                              if(alarm.Runing)
 357   2                              {
 358   3                                      alarm.Runing=0;
 359   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 360   3                              }
 361   2                              PlayMode=PLAY_MUSIC;
 362   2                              enableMute=0;     //½â³ı¾²Òô
 363   2                              enable_SPApause=0;//Îª0±íÊ¾²¥·Å
 364   2                              if(spa_name==SPA_NONE) //spa_nameÎªÃ¶¾Ù±äÁ¿ÀàĞÍ£¬SPA_WHITENOISEÎªÃ¶¾Ù±äÁ¿ÔªËØ
 365   2                                      spa_name=SPA_BRAHM_LULLABY;
 366   2                              else
 367   2                                      spa_cmd=SPA_PALY;                       
 368   2                              /*if(PlayMode==PLAY_BT)
 369   2                              {
 370   2                                      if(flag_bt_play)
 371   2                                      {
 372   2                                              bt_cmd=BT_PALY;//Ğ­ÒéÀïÃæÊÇÒ»ÌõÃüÁî£¬ËùÒÔ²¥·Å/ÔİÍ£¶¼Òª·¢ËÍÕâÌõ
 373   2                                      }
 374   2                              }*/
 375   2                              return;
 376   2                      }
 377   1                      else if(char_compare(WIFI_CMD,"ProPlay\r\n")==0)//½ÓÊÕµ½¾Í²¥·Å×îºóµÄ½ÓÊÕµ½µÄ$$${Program:[00,01,01,00,FFF
             -FFF,03,0A,00,1E]}\r\nÊı¾İ
 378   1                      {//$$${Program
 379   2                              Uart0Transmit_SendString(Uart0_Receive);
 380   2                              if(PlayMode==PLAY_OFF)
 381   2                                      GP389_ON_APP();
 382   2                              if(alarm.Runing)
 383   2                              {
 384   3                                      alarm.Runing=0;
 385   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 386   3                              }
 387   2                              spa_name=program1.spa_name;
 388   2                              color_mode=program1.color_mode;
 389   2                              userR_val=program1.userR_val;
 390   2                              userG_val=program1.userG_val;
 391   2                              userB_val=program1.userB_val;
 392   2                              Light_Brightness=program1.Light_Brightness;
 393   2                              sys_volume=program1.sys_volume;
 394   2                              PlayMode=program1.PlayMode;
 395   2                              enable_SPApause=program1.enable_SPApause;
 396   2                              program1.enableMute=enableMute=((enable_SPApause==0)?0:1);//ÎŞÂÛÖ®Ç°²¥·Å»¹ÊÇÔİÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔ
             -ÊĞí²¥·Å¾Í²¥·Å
 397   2                              spa_cmd=((enable_SPApause==0)?SPA_PALY:SPA_PAUSE);//ÎŞÂÛÖ®Ç°²¥·Å»¹ÊÇÔİÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔÊĞí²¥·Å¾
             -Í²¥·Å
 398   2                              TimerMode=program1.TimerMode;
 399   2                              return;
 400   2                      } 
 401   1                      else if(char_compare(WIFI_CMD,"{Program")==0)//¹Ø»ú×´Ì¬ÏÂ´ò¿ª
 402   1                      {//$$${Program:[00,01,01,00,FFFFFF,03,0A,00,1E]}\r\n
 403   2                              Uart0Transmit_SendString(Uart0_Receive);
 404   2                              if(PlayMode==PLAY_OFF)
 405   2                                      GP389_ON_APP();
 406   2                              if(alarm.Runing)
 407   2                              {
 408   3                                      alarm.Runing=0;
 409   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 410   3                              }
 411   2                              Program1_LaterNum(); //ÏÈ°ÑµÍÊı×Ö¸³¸ø¸ßÊı×Ö£¬
 412   2                              program1.spa_name=spa_name=WIFI_CMD[14]-'0';
 413   2                              program1.color_mode=color_mode=((WIFI_CMD[17]=='1')?COLOR_WHITE:COLOR_OFF);//µÆ¹âµÄ¿ª¹Ø
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 8   

 414   2                              program1.color_mode=color_mode=((WIFI_CMD[17]=='1')?((WIFI_CMD[20]=='1')?COLOR_CHANGE:COLOR_USER):COLOR
             -_OFF);//ÏÈÅĞ¶ÏÉÏÒ»×éÊÇ·ñ¿ªÆôµÆ¹â£¬Èç¹û¿ªÆôµÆ¹â¾ÍÔÙÅĞ¶ÏÊÇ·ñ¿ªÆô²ÊµÆ£¬Èç¹û²»¿ªÆô¾ÍÊÇÓÃ»§Öµ                                                                                                                                                                                                 //ÓÃ»
             -§ÖµÊÇÏÂÃæRGBµÄÖµ
 415   2                              program1.userR_val=userR_val=char_to_hex(WIFI_CMD[22],WIFI_CMD[23]);
 416   2                              program1.userG_val=userG_val=char_to_hex(WIFI_CMD[24],WIFI_CMD[25]);
 417   2                              program1.userB_val=userB_val=char_to_hex(WIFI_CMD[26],WIFI_CMD[27]);
 418   2                              program1.Light_Brightness=Light_Brightness=char_to_bcd(WIFI_CMD[29],WIFI_CMD[30]);
 419   2                              program1.sys_volume=sys_volume=char_to_hex(WIFI_CMD[32],WIFI_CMD[33]);//ÒôÁ¿
 420   2                              program1.PlayMode=PlayMode=PLAY_MUSIC;
 421   2                              program1.enable_SPApause=enable_SPApause=WIFI_CMD[36]-'0';
 422   2                              program1.enableMute=enableMute=((enable_SPApause==0)?0:1);//ÎŞÂÛÖ®Ç°²¥·Å»¹ÊÇÔİÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔ
             -ÊĞí²¥·Å¾Í²¥·Å
 423   2                              spa_cmd=((enable_SPApause==0)?SPA_PALY:SPA_PAUSE);//ÎŞÂÛÖ®Ç°²¥·Å»¹ÊÇÔİÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔÊĞí²¥·Å¾
             -Í²¥·Å
 424   2                              program1.TimerMode=TimerMode=cntTimer=char_to_hex(WIFI_CMD[38],WIFI_CMD[39]);
 425   2                              return;
 426   2                      }
 427   1                      else if(char_compare(WIFI_CMD,"VER0.\r\n")==0) 
 428   1                      {
 429   2                              return;
 430   2                      }
 431   1                      else if(char_compare(WIFI_CMD,"VER\r\n")==0) 
 432   1                      {
 433   2                              Uart0Transmit_SendString(MCU_VER);//Ã¿´ÎÉı¼¶ĞèÒªÊÖ¶¯¸ÄĞ´ÕâÀï
 434   2                              return;
 435   2                      }
 436   1                      else if(char_compare(WIFI_CMD,"GpSta")==0)
 437   1                      {//×îÖÕ×´Ì¬ÊÇ¹Ø»ú
 438   2                              Uart0_SendString_3Step=0;
 439   2                              cntFlag_ON_OFF=0;
 440   2                              return;//PlayMode=PLAY_OFF;     ÒòÎªÓĞÇ¿ÖÆ¹Ø»ú£¬ËùÒÔ¿ÉÒÔ²»ÒªGP389_OFF()/GP389_ON()
 441   2                      }
 442   1      //              else if(char_compare(WIFI_CMD,"GpSta:[00]\r\n")==0)
 443   1      //              {//×îÖÕ×´Ì¬ÊÇ¿ª»ú£¬
 444   1      //                      Uart0_SendString_3Step=0;
 445   1      //                      cntFlag_ON_OFF=0;
 446   1      //                      return;//PlayMode=PLAY_OFF;     ÒòÎªÓĞÇ¿ÖÆ¹Ø»ú£¬ËùÒÔ¿ÉÒÔ²»ÒªGP389_OFF()/GP389_ON()
 447   1      //              }
 448   1              
 449   1              
 450   1              if(PlayMode!=PLAY_OFF)
 451   1              {
 452   2                      if(char_compare(WIFI_CMD,"{TimeSync")==0)
 453   2                      {//$$${TimeSync:[0A/20/00/12/01/01/02]}\r\n
 454   3      //                      IE3 &= ~0x04;           // Enable WT interrupt
 455   3      //                      gRTC_Hour  =char_to_hex(WIFI_CMD[11],WIFI_CMD[12]);
 456   3      //                      gRTC_Minute=char_to_hex(WIFI_CMD[14],WIFI_CMD[15]);
 457   3      //                      gRTC_Sec   =char_to_hex(WIFI_CMD[17],WIFI_CMD[18]);
 458   3      //                      gRTC_Week  =WIFI_CMD[30]-'0';
 459   3      //                      gRTC_Week  =Week_Table[gRTC_Week];
 460   3      //                      IE3 |= 0x04;            // Enable WT interrupt
 461   3      //                      Falg_TimeSync_Allow=0;//½ÓÊÕµ½Í¬²½ĞÅÏ¢¾Í²»ÔÙ·¢ËÍÇëÇóÍ¬²½£¬ËùÒÔÖÃÎª0
 462   3                              return;
 463   3                      }       
 464   2                      else if(char_compare(WIFI_CMD, "Turn off unit")==0) 
 465   2                      {//ÕâÌõĞ­ÒéÃüÁîÊÇappÖ±½Ó·¢ËÍ¹ıÀ´µÄ¹Ø»úÃüÁî£¬²»ÓÃÉêÇë¾Í¿ÉÒÔ¹Ø»ú£¬µ«ÊÇÊÕµ½ÕâÌõÃüÁîÒªÅĞ¶Ï
 466   3                       //´ËÊ±²»ÓÃ½øĞĞÅĞ¶ÏÊÇ²»ÊÇÔÚ¹Ø»ú×´Ì¬£¬ÒòÎª¹Ø»úÖ®ºóĞèÒªÉè¶¨µÄ×´Ì¬¶Ô³ÌĞòÎŞÓ°Ïì£¬»òÕß¿ª»úÖ®
 467   3                       //ºó»á³õÊ¼»¯ÕâĞ©×´Ì¬
 468   3                       //$$$Turn off unit\r\n
 469   3                              Uart0Transmit_SendString(Uart0_Receive);
 470   3                              if(alarm.Runing)
 471   3                              {
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 9   

 472   4                                      GP389_OFF_AND_AlarmOFF();
 473   4                                      return;
 474   4                              }
 475   3                              
 476   3                              Uart0_SendString_3Step=3;
 477   3                              GP389_OFF();
 478   3                              //ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 479   3                              return;
 480   3                      }
 481   2                      else if(char_compare(WIFI_CMD, "Turn on BT")==0) 
 482   2                      {//$$$Turn on BT\r\n
 483   3                              PlayMode=PLAY_BT;
 484   3                      }
 485   2                      else if(char_compare(WIFI_CMD, "music pause")==0)
 486   2                      {//$$$music pause\r\n
 487   3                              if(PlayMode==PLAY_MUSIC)
 488   3                              {                                   
 489   4                                      enable_SPApause=1;
 490   4                                      spa_cmd=SPA_PAUSE;
 491   4                              }
 492   3      //                      if(PlayMode==PLAY_BT)
 493   3      //                      {
 494   3      //                              if(flag_bt_play) 
 495   3      //                              {
 496   3      //                                      bt_cmd=BT_PAUSE;//Ğ­ÒéÀïÃæÊÇÒ»ÌõÃüÁî£¬ËùÒÔ²¥·Å/ÔİÍ£¶¼Òª·¢ËÍÕâÌõ
 497   3      //                              }
 498   3      //                      }
 499   3                              return;
 500   3                      }
 501   2                      else if(char_compare(WIFI_CMD,"{MusicStatus")==0)
 502   2                      {
 503   3                              return;
 504   3                      }
 505   2                      else if(char_compare(WIFI_CMD, "Adjust Output Volume")==0)
 506   2                      {//$$$Adjust Output Volume01\r\n
 507   3                              if(alarm.Runing)
 508   3                              {
 509   4                                      GP389_OFF_AND_AlarmOFF();
 510   4                                      return;
 511   4                              }
 512   3                              sys_volume=char_to_bcd(WIFI_CMD[20],WIFI_CMD[21]);
 513   3                              enableMute=0;
 514   3                      }
 515   2                      else if(char_compare(WIFI_CMD, "volume up")==0) 
 516   2                      {//$$$volume up\r\n
 517   3                              if(alarm.Runing)
 518   3                              {
 519   4                                      GP389_OFF_AND_AlarmOFF();
 520   4                                      return;
 521   4                              }
 522   3                              sys_volume=((sys_volume < 10)?((sys_volume<=8)?(sys_volume += 2):(sys_volume += 1)):10);
 523   3                              enableMute=0;
 524   3                      }
 525   2                      else if(char_compare(WIFI_CMD, "volume down")==0) 
 526   2                      {//volume down\r\n
 527   3                              if(alarm.Runing)
 528   3                              {
 529   4                                      GP389_OFF_AND_AlarmOFF();
 530   4                                      return;
 531   4                              }
 532   3                              sys_volume=((sys_volume > 1)?((sys_volume>=3)?(sys_volume -= 2):(sys_volume -= 1)):1);
 533   3                              enableMute=0;
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 10  

 534   3                      }
 535   2                      else if(char_compare(WIFI_CMD, "music mute")==0) 
 536   2                      {//$$$music mute\r\n
 537   3                              enableMute=1;
 538   3                              return;
 539   3                      }
 540   2                      else if(char_compare(WIFI_CMD, "music unmute")==0) 
 541   2                      {//$$$music unmute\r\n
 542   3                              enableMute=0;
 543   3                              return;
 544   3                      }
 545   2                      else if(char_compare(WIFI_CMD, "Set Timer")==0)//ok
 546   2                      {//$$$Set Timer 15\r\n(15/30/60)
 547   3                              if(alarm.Runing)
 548   3                              {
 549   4                                      GP389_OFF_AND_AlarmOFF();
 550   4                                      return;
 551   4                              }
 552   3                              TimerMode=cntTimer=char_to_bcd(WIFI_CMD[10],WIFI_CMD[11]);
 553   3                      }
 554   2                      else if(char_compare(WIFI_CMD, "Turn off Timer")==0)//ok
 555   2                      {//$$$Turn off Timer\r\n
 556   3                              if(alarm.Runing)
 557   3                              {
 558   4                                      GP389_OFF_AND_AlarmOFF();
 559   4                                      return;
 560   4                              }
 561   3                              TimerMode=cntTimer=TIMER_OFF;
 562   3                      }
 563   2                      else if(char_compare(WIFI_CMD, "Turn off Lightr")==0)  
 564   2                      {//$$$Turn off Lightr\r\n
 565   3                              if(alarm.Runing)
 566   3                              {
 567   4                                      GP389_OFF_AND_AlarmOFF();
 568   4                                      return;
 569   4                              }
 570   3                              color_mode=COLOR_OFF;
 571   3                      } 
 572   2                      else if(char_compare(WIFI_CMD,"light up")==0)
 573   2                      {//$$$light up\r\n
 574   3                              if(alarm.Runing)
 575   3                              {
 576   4                                      GP389_OFF_AND_AlarmOFF();
 577   4                                      return;
 578   4                              }
 579   3                              if(Light_Brightness<3)
 580   3                                      Light_Brightness++;
 581   3                      }
 582   2                      else if(char_compare(WIFI_CMD,"light down")==0)
 583   2                      {//$$$light down\r\n
 584   3                              if(alarm.Runing)
 585   3                              {
 586   4                                      GP389_OFF_AND_AlarmOFF();
 587   4                                      return;
 588   4                              }
 589   3                              if(Light_Brightness>0)
 590   3                                      Light_Brightness--;
 591   3                      }
 592   2                      else if(char_compare(WIFI_CMD,"Adjust Light Brightness")==0)
 593   2                      {//$$$Adjust Light Brightness 01\r\n(01-03)
 594   3                              if(alarm.Runing)
 595   3                              {
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 11  

 596   4                                      GP389_OFF_AND_AlarmOFF();
 597   4                                      return;
 598   4                              }
 599   3                              Light_Brightness=char_to_bcd(WIFI_CMD[24],WIFI_CMD[25]);
 600   3                      }
 601   2                      else if(char_compare(WIFI_CMD,"AlaGpSta\r\n")==0) 
 602   2                      {//W-G:"$$$AlaGpSta\r\n"
 603   3                       //G-W:"$$${AlaGpSta:[00,01,01,00,FFFFFF,03,0A,00,01,FF,17:3B,FF]}\r\n"
 604   3                       //Êı×éÖĞµÚÊı¾İÒÔ¶ººÅ·Ö¸ô£¬Êı×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ğ´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨13¸ö×Ö¶Î£©·Ö±ğ±íÊ¾£
             -º
 605   3                       //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓĞÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 606   3                       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 607   3                       //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 608   3                       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 609   3                       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 610   3                       //¡·´ú±íÁÁ¶È( 00 - 03 )
 611   3                       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 612   3                       //¡·´ú±íÔİÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õı³£²¥·Å,01±íÊ¾ÔİÍ£²¥·Å£©
 613   3                       //£¨È¥µô£©¡·´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 614   3                       //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 615   3                       //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 616   3                       //    0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 617   3                       //    0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 618   3                       //    0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 619   3                       //    BIT            7       6    5    4    3    2    1    0
 620   3                       //    ĞÇÆÚx   repeat  ÈÕ  Áù  Îå  ËÄ  Èı  ¶ş  Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î£¬ÕâÒ»´Î
 621   3                       //  ÊÇÆßÌìÖ®ÄÚµÄ£¬¼ÙÈç¶¨Ê±13:00£¬²»ÖØ¸´£¬ÄÇÕâ´Î¼ÆÊ±µ½(7*24*60-1)minÖ®ºó½áÊø£¬¼´ÆßÌìÖ®ºó
 622   3                       //  µÄ12:59·Ö£©
 623   3                       //¡·´ú±íÄÖÖÓ¶¨Ê±Ê±¼äµã£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 624   3                       //¡·´ú±íÏìÁåÊ±¼ä£¨charÀàĞÍ1¸ö×Ö½Ú£©00-FF (µ¥Î»:·ÖÖÓ)
 625   3                       //£¨È¥µô£©¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ğ°´ÕÕÊ®Áù½øÖÆÊı¼ÓĞ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ĞÇÆÚ£© 
 626   3                       //    ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëĞÇÆÚ¶ş ÄÇÃ´¸ñÊ½ÊÇ 0a/20/00/12/01/01/02
 627   3                              char  code respAlaGpSta[]={"$$${AlaGpSta:[00,00,00,00,000000,00,00,00,00,00,00:00,00]}\r\n"};
 628   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 629   3                                      Uart0_Receive[i]=0x00;
 630   3                              for(i=0;i<62;i++)
 631   3                                      Uart0_Receive[i]=respAlaGpSta[i];
 632   3                              hex_to_char(&Uart0_Receive[14],0);//IDºÅÄ¬ÈÏÎª0
 633   3                              hex_to_char(&Uart0_Receive[17],((alarm.spa_name!=0)?alarm.spa_name:7));//Ê×ÏÈÅĞ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ
             -£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔİÍ££¬7
 634   3                              hex_to_char(&Uart0_Receive[20],((alarm.color_mode==COLOR_OFF)?0:1));//¿ª¹ØµÆ
 635   3                              hex_to_char(&Uart0_Receive[23],(((alarm.color_mode==COLOR_CHANGE)?1:0)));//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½
             -£©
 636   3                              hex_to_char(&Uart0_Receive[26],alarm.userR_val);
 637   3                              hex_to_char(&Uart0_Receive[28],alarm.userG_val);
 638   3                              hex_to_char(&Uart0_Receive[30],alarm.userB_val);
 639   3                              hex_to_char(&Uart0_Receive[33],alarm.Brightness);//ÁÁ¶È
 640   3                              hex_to_char(&Uart0_Receive[36],alarm.volume);//ÒôÁ¿
 641   3                              hex_to_char(&Uart0_Receive[39],alarm.play_pause);
 642   3                              hex_to_char(&Uart0_Receive[42],alarm.Enable);
 643   3                              hex_to_char(&Uart0_Receive[45],alarm.Week);
 644   3                              hex_to_char(&Uart0_Receive[48],alarm.Hour);
 645   3                              hex_to_char(&Uart0_Receive[51],alarm.Minute);
 646   3                              hex_to_char(&Uart0_Receive[54],alarm.Duration);
 647   3                              Uart0_SendString_3Step=2;
 648   3                      }
 649   2                      else if(char_compare(WIFI_CMD,"NorGpSta\r\n")==0)
 650   2                      {//W-G:"$$$NorGpSta\r\n"
 651   3                       //G-W:"$$${NorGpSta:[00,00,01,01,FFFFFF,03,0A,00,1E]}\r\n"
 652   3                              char  code respNorGpSta[]={"$$${NorGpSta:[00,00,00,00,000000,00,00,00,00]}\r\n"};
 653   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 654   3                                      Uart0_Receive[i]=0x00;
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 12  

 655   3                              for(i=0;i<48;i++)
 656   3                                      Uart0_Receive[i]=respNorGpSta[i];
 657   3                              hex_to_char(&Uart0_Receive[14],1);//ÔÚÕâÀïÊÇ¿ª»ú
 658   3                              hex_to_char(&Uart0_Receive[17],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅĞ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬Ê
             -ÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔİÍ££¬7
 659   3                              hex_to_char(&Uart0_Receive[20],(color_mode==COLOR_OFF)?0:1);
 660   3                              hex_to_char(&Uart0_Receive[23],(color_mode==COLOR_CHANGE)?0:1);//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½£©
 661   3                              hex_to_char(&Uart0_Receive[26],userR_val);
 662   3                              hex_to_char(&Uart0_Receive[28],userG_val);
 663   3                              hex_to_char(&Uart0_Receive[30],userB_val);
 664   3                              hex_to_char(&Uart0_Receive[33],Light_Brightness);
 665   3                              hex_to_char(&Uart0_Receive[36],sys_volume);
 666   3                              hex_to_char(&Uart0_Receive[39],enable_SPApause);
 667   3                              hex_to_char(&Uart0_Receive[42],cntTimer);
 668   3                              Uart0_SendString_3Step=2;
 669   3                      }
 670   2                      else if(char_compare(WIFI_CMD," update")==0) 
 671   2                      {//mcu update+0X43A4+0X0044,½ÓÊÕµ½Õâ¸öĞÅÏ¢¿ªÊ¼Éı¼¶
 672   3                              Update_ByteSizeSum=(char_to_hex(WIFI_CMD[10],WIFI_CMD[11])<<8)|char_to_hex(WIFI_CMD[12],WIFI_CMD[13]);/
             -/¶àÉÙ¸ö×Ö½Ú£¬µØÎ»ÔÚÇ°£¬¸ßÎ»ÔÚºó
 673   3                              Update_PacketSum  =(char_to_hex(WIFI_CMD[17],WIFI_CMD[18])<<8)|char_to_hex(WIFI_CMD[19],WIFI_CMD[20]);/
             -/¶àÉÙ¸ö°ü
 674   3                              update_handle();
 675   3                      }
 676   2                      else if(char_compare(WIFI_CMD,"ATWQ\r\n")==0) 
 677   2                      {//$$$ATWQ\r\n
 678   3                              Uart0_SendString_3Step=0;
 679   3                              return;
 680   3                      }
 681   2                      else if(char_compare(WIFI_CMD,"VER\r\n")==0) 
 682   2                      {
 683   3                              Uart0Transmit_SendString(MCU_VER);//Ã¿´ÎÉı¼¶ĞèÒªÊÖ¶¯¸ÄĞ´ÕâÀï
 684   3                              return;
 685   3                      }
 686   2                      else if(char_compare(WIFI_CMD,"Enter TestMode:")==0) 
 687   2                      {
 688   3                              Uart0_SendString_3Step=0;
 689   3                              cntFlash=0;
 690   3                              Led_Flash=0;
 691   3                              setFactory=1;//ÖÃÒ»ÈÃÈı¸ötimerµÆ³£ÁÁÈıÃë
 692   3                              PlayMode=PLAY_ON;
 693   3                              bt_send_cmd(BT_CLEAR_LIST);//Çå³ıÀ¶ÑÀÁĞ±íÁĞ±í
 694   3                              return;
 695   3                      }
 696   2                      Uart0Transmit_SendString(Uart0_Receive);
 697   2                      ////////////////////////////////////////////////////////////////////////////////////
 698   2                      ////////////////////////////////////////////////////////////////////////////////////
 699   2              }
 700   1              else //¹Ø»ú×´Ì¬ÏÂ½ÓÊÕÌØ¶¨wifiÊı¾İ
 701   1              {
 702   2                      if(char_compare(WIFI_CMD,"{NorGpSta")==0)
 703   2                      {//W-G:"$$$NorGpSta\r\n"
 704   3                       //G-W:"$$${NorGpSta:[00,00,01,01,FFFFFF,03,0A,00,1E]}\r\n"
 705   3                              char  code respNorGpSta[]={"$$${NorGpSta:[00,00,00,00,000000,00,00,00,00]}\r\n"};
 706   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 707   3                                      Uart0_Receive[i]=0x00;
 708   3                              for(i=0;i<48;i++)
 709   3                                      Uart0_Receive[i]=respNorGpSta[i];
 710   3                              hex_to_char(&Uart0_Receive[14],0);//ÔÚÕâÀïÊÇ¿ª»ú
 711   3                              hex_to_char(&Uart0_Receive[17],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅĞ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬Ê
             -ÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔİÍ££¬7
 712   3                              hex_to_char(&Uart0_Receive[20],(color_mode==COLOR_OFF)?0:1);
C51 COMPILER V9.00   WIFI_MODE                                                             08/04/2018 12:05:33 PAGE 13  

 713   3                              hex_to_char(&Uart0_Receive[23],(color_mode==COLOR_CHANGE)?0:1);//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½£©
 714   3                              hex_to_char(&Uart0_Receive[26],userR_val);
 715   3                              hex_to_char(&Uart0_Receive[28],userG_val);
 716   3                              hex_to_char(&Uart0_Receive[30],userB_val);
 717   3                              hex_to_char(&Uart0_Receive[33],Light_Brightness);
 718   3                              hex_to_char(&Uart0_Receive[36],sys_volume);
 719   3                              hex_to_char(&Uart0_Receive[39],enable_SPApause);
 720   3                              hex_to_char(&Uart0_Receive[42],cntTimer);
 721   3                              Uart0_SendString_3Step=2;
 722   3                      }
 723   2                      Uart0Transmit_SendString(Uart0_Receive);
 724   2              }
 725   1      }
 726          
 727          void Program1_LaterNum()
 728          {
 729   1              program3=program2;//ÒòÎªÊı¾İºÍÊı¾İÀàĞÍÍêÈ«Ò»Ñù£¬ËùÒÔ¿ÉÒÔÖ±½Ó¸³Öµ
 730   1              program2=program1;
 731   1      }
 732          
 733          
 734          
 735          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4951    ----
   CONSTANT SIZE    =    855    ----
   XDATA SIZE       =      1      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
