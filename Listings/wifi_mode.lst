C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE WIFI_MODE
OBJECT MODULE PLACED IN .\Objects\wifi_mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE source\wifi_mode.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\
                    -include) DEBUG OBJECTEXTEND PRINT(.\Listings\wifi_mode.lst) OBJECT(.\Objects\wifi_mode.obj)

line level    source

   1          //Í·ÎÄ¼þheader file//
   2          #include "app_main.h"
   3          
   4          //ºê¶¨Òåmacro definition//
   5          
   6          //ÀàÐÍ¶¨Òåbyte definition//
   7          
   8          //±äÁ¿¶¨Òåvariable definition//
   9          uint8_t  code Week_Table[]={0x01,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};
  10          
  11          char  code SPASongs_Num_Table[7][24]= 
  12          {
  13                  "$$${MusicStatus:[07]}\r\n",
  14                  "$$${MusicStatus:[01]}\r\n",
  15                  "$$${MusicStatus:[02]}\r\n",
  16                  "$$${MusicStatus:[03]}\r\n",
  17                  "$$${MusicStatus:[04]}\r\n",
  18                  "$$${MusicStatus:[05]}\r\n",
  19                  "$$${MusicStatus:[06]}\r\n",
  20          };
  21          
  22          //±êÖ¾Î´¶¨Òåflags definetion//
  23          
  24          //º¯ÊýÉùÃ÷Function declaration//
  25          void Program1_LaterNum();
  26          
  27          //º¯Êý¶¨Òåfunction definetion//
  28          /*******************************************************************
  29          º¯ÊýÔ­ÐÍ£º
  30          ÊäÈë²ÎÊý£º
  31          Êä³ö²ÎÊý£º
  32          º¯Êý¹¦ÄÜ£º
  33          *******************************************************************/
  34          uint8_t char_compare( char *source,  char *dest)
  35          {
  36   1              while(*dest)
  37   1              {       
  38   2                      if((*source!=*dest)||(*source==0)||(*dest==0))
  39   2                              return 1;
  40   2                      source++;
  41   2                      dest++;
  42   2              }
  43   1              return 0;
  44   1      }
  45          
  46          /*******************************************************************
  47          º¯ÊýÔ­ÐÍ£º
  48          ÊäÈë²ÎÊý£º
  49          Êä³ö²ÎÊý£º
  50          º¯Êý¹¦ÄÜ£º
  51          *******************************************************************/
  52          char char_to_hex(char indata1,char indata2)
  53          {
  54   1              if(indata1>='A')
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 2   

  55   1                      indata1=((indata1-'A')+0x0A);
  56   1              else
  57   1                      indata1=(indata1-'0');
  58   1              if(indata2>='A')
  59   1                      indata2=((indata2-'A')+0x0A);
  60   1              else
  61   1                      indata2=(indata2-'0');
  62   1              return ((indata1<<4)|indata2);
  63   1      }
  64          
  65          /*******************************************************************
  66          º¯ÊýÔ­ÐÍ£º
  67          ÊäÈë²ÎÊý£º
  68          Êä³ö²ÎÊý£º
  69          º¯Êý¹¦ÄÜ£º
  70          *******************************************************************/
  71          char char_to_bcd(char indata1,char indata2)
  72          {
  73   1              if(indata1>='A')
  74   1                      indata1=((indata1-'A')+0x0A);
  75   1              else
  76   1                      indata1=(indata1-'0');
  77   1              if(indata2>='A')
  78   1                      indata2=((indata2-'A')+0x0A);
  79   1              else
  80   1                      indata2=(indata2-'0');
  81   1              return (indata1*10+indata2);
  82   1      }
  83          
  84          /*******************************************************************
  85          º¯ÊýÔ­ÐÍ£º
  86          ÊäÈë²ÎÊý£º
  87          Êä³ö²ÎÊý£º
  88          º¯Êý¹¦ÄÜ£º
  89          *******************************************************************/
  90          void hex_to_char(uint8_t *p,uint8_t indata)
  91          {
  92   1              uint8_t tmp;
  93   1              tmp=indata>>4;
  94   1              if(tmp>=0x0A)
  95   1               *p=((tmp-0x0A)+'A'); 
  96   1              else
  97   1               *p=(tmp+'0');
  98   1              p++;
  99   1              tmp=indata&0x0F;
 100   1              if(tmp>=0x0A)
 101   1                      *p=((tmp-0x0A)+'A'); 
 102   1              else
 103   1                      *p=(tmp+'0');
 104   1      }
 105          
 106          /*******************************************************************
 107          º¯ÊýÔ­ÐÍ£º
 108          ÊäÈë²ÎÊý£º
 109          Êä³ö²ÎÊý£º
 110          º¯Êý¹¦ÄÜ£º
 111          *******************************************************************/
 112          void GP389_ON(void) //
 113          {
 114   1              PlayMode=PLAY_ON;
 115   1              PlayMode=((PlayMode_bk==PLAY_MUSIC)?PLAY_MUSIC:PLAY_ON);//Èç¹û¹Ø»úÊ±ÊÇmusicÄ£Ê½£¬¿ª»ú»Ø¸´´ËÄ£Ê½
 116   1              sys_volume=sys_volume_bk;
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 3   

 117   1              color_mode=color_mode_bk;
 118   1              //Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);//¹Ø»úÖ®Ç°Èç¹ûÁÁ¶ÈÎª0¾Í»Ö¸´Îª1£¬·ñÔòÎª¹Ø»úÖ
             -®Ç°ÁÁ¶È//2018.4.9¹Ø»úÖ®Ç°ÁÁ¶ÈÎª0£¬¿ª»úÒ²Îª0
 119   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 120   1              
 121   1              Uart0_SendString_3Step=3;
 122   1      }
 123          
 124          /*******************************************************************
 125          º¯ÊýÔ­ÐÍ£º
 126          ÊäÈë²ÎÊý£º
 127          Êä³ö²ÎÊý£º
 128          º¯Êý¹¦ÄÜ£º
 129          *******************************************************************/
 130          void GP389_ON_APP(void) //
 131          {
 132   1              PlayMode=PLAY_ON;
 133   1              sys_volume=sys_volume_bk;
 134   1              //Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);//¹Ø»úÖ®Ç°Èç¹ûÁÁ¶ÈÎª0¾Í»Ö¸´Îª1£¬·ñÔòÎª¹Ø»úÖ
             -®Ç°ÁÁ¶È//2018.4.9¹Ø»úÖ®Ç°ÁÁ¶ÈÎª0£¬¿ª»úÒ²Îª0
 135   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 136   1              Uart0_SendString_3Step=3;
 137   1      }
 138          
 139          /*******************************************************************
 140          º¯ÊýÔ­ÐÍ£º
 141          ÊäÈë²ÎÊý£º
 142          Êä³ö²ÎÊý£º
 143          º¯Êý¹¦ÄÜ£º
 144          *******************************************************************/
 145          void GP389_OFF(void) //
 146          {
 147   1              PlayMode_bk=PlayMode;
 148   1              PlayMode=PLAY_OFF;
 149   1              sys_volume_bk=sys_volume;
 150   1              color_mode_bk=color_mode;
 151   1              color_mode=COLOR_OFF;
 152   1              TimerMode=cntTimer=TIMER_OFF;//
 153   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 154   1              Uart0_SendString_3Step=3;
 155   1      }
 156          
 157          /*******************************************************************
 158          º¯ÊýÔ­ÐÍ£º
 159          ÊäÈë²ÎÊý£º
 160          Êä³ö²ÎÊý£º
 161          º¯Êý¹¦ÄÜ£º
 162          *******************************************************************/
 163          void GP389_OFF_AND_AlarmOFF()
 164          {//ÄÖÖÓÔÚÏìÓ¦Ê±²Ù×÷ÔÚAPPÉÏµ÷ÁËµÆ¹âÁÁ¶È£¬ÒôÁ¿´óÐ¡£¬Ôò¹Ø±ÕÄÖÁå²¢¹Ø»ú£¬ÔÚappÉÏµãÁËÌØ¶¨
 165   1       //ÑÕÉ«µÄµÆ¹â£¬»òÕßµãÁËÌØ¶¨ÒôÀÖ£¬»òÕßµãÁËprogram,ÄÇÃ´ÄÖÖÓÍ£Ö¹£¬ÏìÓ¦ËùµãµÄ²Ù×÷
 166   1              alarm.Runing=0;
 167   1              gbKeyNone=0;
 168   1              GP389_OFF();
 169   1              //color_mode=COLOR_OFF;
 170   1              Uart0_SendString_3Step=5;
 171   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);       
 172   1              TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF;    
 173   1              return;
 174   1      }
 175          
 176          /*******************************************************************
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 4   

 177          º¯ÊýÔ­ÐÍ£º
 178          ÊäÈë²ÎÊý£º
 179          Êä³ö²ÎÊý£º
 180          º¯Êý¹¦ÄÜ£º
 181          *******************************************************************/
 182          void ApplicationGP389_ONOFF(uint8_t onoff)//ÉêÇë¿ª¹Ø»úÊ±µ÷ÓÃ´Ëº¯Êý
 183          {//$$${GpSta:[00,00,01,01,FFFFFF,03,0A,00,1E;00,01,00,FFFFFF,03,0A,01,FF,17:3B,FF]}\r\n
 184   1       //Êý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨Ç°10¸ö×Ö¶Î£©·Ö±ð±íÊ¾£
             -º
 185   1       //¡·ÊÇ·ñ¹Ø»ú,00ÊÇ¿ª»ú£¬01ÊÇ¹Ø»ú
 186   1       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 187   1       //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 188   1       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 189   1       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 190   1       //¡·´ú±íÁÁ¶È( 00 - 03 )
 191   1       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0A )
 192   1       //¡·´ú±íÔÝÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õý³£²¥·Å,01±íÊ¾ÔÝÍ£²¥·Å£©
 193   1       //¡·´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 194   1       //¡·Ó¢ÎÄ·ÖºÅ¡°;¡±¸ô¿ªÕâÁ½²¿·ÖÃüÁî
 195   1       //¡·ÄÖÖÓ¿ØÖÆÐÅÏ¢£ºÊý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨10¸ö×
             -Ö¶Î£©·Ö±ð±íÊ¾£º
 196   1       //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓÐÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 197   1       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 198   1       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 199   1       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 200   1       //¡·´ú±íÁÁ¶È( 00 - 03 )
 201   1       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 202   1       //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 203   1       //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 204   1       //  0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 205   1       //  0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 206   1       //  0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 207   1       //  BIT            7       6    5    4    3    2    1    0
 208   1       //  ÐÇÆÚx   repeat  ÈÕ  Áù  Îå  ËÄ  Èý  ¶þ  Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î£¬ÕâÒ»´Î
 209   1       //  ÊÇÆßÌìÖ®ÄÚµÄ£¬¼ÙÈç¶¨Ê±13:00£¬²»ÖØ¸´£¬ÄÇÕâ´Î¼ÆÊ±µ½(7*24*60-1)minÖ®ºó½áÊø£¬¼´ÆßÌìÖ®ºó
 210   1       //  µÄ12:59·Ö£©
 211   1       //¡·´ú±íÄÖÖÓÊ±¼ä£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 212   1       //¡·´ú±íÏìÁåÊ±¼ä£¨charÀàÐÍ1¸ö×Ö½Ú£©00-FF (µ¥Î»:·ÖÖÓ)
 213   1              char i;
 214   1              char code respGP389_AllSta[]={"$$${GpSta:[00,00,00,00,000000,00,00,00,00;00,00,00,000000,00,00,00,00,00:0
             -0,00]}\r\n"};
 215   1              do{WDT_clear();} while(Uart0_EnableSend);
 216   1              Count200ms_3Step=0;
 217   1              //Uart0_SendString_3Step=0;
 218   1              for(i=0;i<UART0_LEN_BUFFER;i++)
 219   1                      Uart0_TransmitBuffer[i]=0x00;
 220   1              for(i=0;i<82;i++)
 221   1                      Uart0_TransmitBuffer[i]=respGP389_AllSta[i];
 222   1              hex_to_char(&Uart0_TransmitBuffer[11],onoff);
 223   1              hex_to_char(&Uart0_TransmitBuffer[14],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹û
             -ÊÇ£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 224   1              hex_to_char(&Uart0_TransmitBuffer[17],((color_mode==COLOR_OFF)?0:1));//Îª1Ê±ÊÇÒª¹Ø»ú£¬ËùÒÔÒªºÍcolor_mode_
             -bk¶Ô±È£¬Îª0ÊÇÒª¿ª»ú£¬ÒÑ¾­°Ñcolor_mode_bk¸³Öµ¸øcolor_mode
 225   1              hex_to_char(&Uart0_TransmitBuffer[20],((color_mode==COLOR_CHANGE)?1:0));
 226   1              hex_to_char(&Uart0_TransmitBuffer[23],userR_val);
 227   1              hex_to_char(&Uart0_TransmitBuffer[25],userG_val);       
 228   1              hex_to_char(&Uart0_TransmitBuffer[27],userB_val);
 229   1              hex_to_char(&Uart0_TransmitBuffer[30],Light_Brightness);
 230   1              hex_to_char(&Uart0_TransmitBuffer[33],sys_volume);
 231   1              hex_to_char(&Uart0_TransmitBuffer[36],enable_SPApause);
 232   1              hex_to_char(&Uart0_TransmitBuffer[39],cntTimer);
 233   1              hex_to_char(&Uart0_TransmitBuffer[42],00);//ÄÖÖÓIDºÅÄ¬ÈÏÎª0
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 5   

 234   1              hex_to_char(&Uart0_TransmitBuffer[45],alarm.spa_name);//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²
             -»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 235   1              hex_to_char(&Uart0_TransmitBuffer[48],((alarm.color_mode==COLOR_CHANGE)?1:0));//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ
             -£Ê½£©
 236   1              hex_to_char(&Uart0_TransmitBuffer[51],alarm.userR_val);
 237   1              hex_to_char(&Uart0_TransmitBuffer[53],alarm.userG_val); 
 238   1              hex_to_char(&Uart0_TransmitBuffer[55],alarm.userB_val);
 239   1              hex_to_char(&Uart0_TransmitBuffer[58],alarm.Brightness);//ÁÁ¶È
 240   1              hex_to_char(&Uart0_TransmitBuffer[61],alarm.volume);//ÒôÁ¿
 241   1              hex_to_char(&Uart0_TransmitBuffer[64],alarm.Enable); //ÄÖÖÓ×Ü¿ª¹Ø
 242   1              hex_to_char(&Uart0_TransmitBuffer[67],alarm.Week);  //ÄÖÖÓÖÜ¼¸ÏìµÍ4Î»
 243   1              hex_to_char(&Uart0_TransmitBuffer[70],alarm.Hour);  //ÄÖÖÓ¶¨Ê±µÄÊ±¼ä£¬Ð¡Ê±µÍËÄÎ»
 244   1              hex_to_char(&Uart0_TransmitBuffer[73],alarm.Minute);//ÄÖÖÓ¶¨Ê±µÄÊ±¼ä£¬·ÖÖÓµÍËÄÎ»
 245   1              hex_to_char(&Uart0_TransmitBuffer[76],alarm.Duration);//ÄÖÖÓÏìÁåÊ±¼ä£¬µÍËÄÎ»
 246   1              Uart0_SendString_3Step=2;
 247   1              Uart0_Tx_Pointer=0;
 248   1              Uart0_EnableSend=1;
 249   1              Uart0_Tx_TimeOut=10;    
 250   1              USI0DR=Uart0_TransmitBuffer[Uart0_Tx_Pointer++];
 251   1              if(cntFlag_ON_OFF==0)
 252   1                      cntFlag_ON_OFF=2;
 253   1      }
 254          
 255          /*******************************************************************
 256          º¯ÊýÔ­ÐÍ£º
 257          ÊäÈë²ÎÊý£º
 258          Êä³ö²ÎÊý£º
 259          º¯Êý¹¦ÄÜ£º
 260          *******************************************************************/
 261          void Wifi_CommandDeal(char *Uart0_Receive)
 262          {
 263   1              uint8_t i;
 264   1              char *WIFI_CMD;
 265   1              WIFI_CMD=&Uart0_Receive[3];
 266   1              if(char_compare(WIFI_CMD,"{AlarmSet")==0)//ok
 267   1              {//$$${AlarmSet:[00,01,00,01,FFFFFF,03,0A,00,00,FF,17:3B,FF,0a/20/00/12/01/01/02]}\r\n
 268   2               //Êý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨10¸ö×Ö¶Î£©·Ö±ð±íÊ¾£º
 269   2               //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓÐÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 270   2               //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 271   2               //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 272   2               //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·,£©
 273   2               //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 274   2               //¡·£¨È¥µô£©´ú±íµÆÑÕÉ«µÄÏÂ±ê£¬Óëapp½çÃæÖÐµÆÒ»ÖÂ£¬·½±ãµÆ×´Ì¬Í¬²½ÔÆ¶ËºÍapp£¨00-0B£©,ÆäÖÐ00´ú±í¹ØµÆ£¬0A´ú±í
             -²ÊµÆ£¬0B´ú±í×Ô¶¨ÒåÑÕÉ«
 275   2               //¡·´ú±íÁÁ¶È( 00 - 03 )
 276   2               //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 277   2               //¡·´ú±íÔÝÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õý³£²¥·Å,01±íÊ¾ÔÝÍ£²¥·Å£©
 278   2               //¡·(È¥µô)£º´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 279   2               //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 280   2               //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 281   2               //  0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 282   2               //  0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 283   2               //  0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 284   2               //  BIT      7       6    5    4    3    2    1    0
 285   2               //  ÐÇÆÚx  repeat    ÈÕ   Áù   Îå    ËÄ   Èý   ¶þ   Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î
 286   2               //¡·´ú±íÄÖÖÓ¶¨Ê±Ê±¼äµã£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 287   2               //¡·´ú±íÏìÁåÊ±¼ä£¨intÀàÐÍ4¸ö×Ö½Ú£©00-FF (µ¥Î»ÓÉÇ¿´ó¶¨Òå)
 288   2               //¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ð°´ÕÕÊ®Áù½øÖÆÊý¼ÓÐ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ÐÇÆÚ£©
 289   2               //  ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëÐÇÆÚ¶þ ÄÇÃ´¸ñÊ½ÊÇ 0a/20/00/12/01/01/02
 290   2               //(WIFI_CMD[11]-'0')  //ProgrammaµÄIDºÅÔÝÊ±Ã»ÓÐ£¬ÎªÒÔºóÀ©Õ¹Ô¤±¸   
 291   2                      alarm.spa_name  =(WIFI_CMD[15]-'0');//µÚ¼¸Ê×¸è
 292   2                      if(alarm.spa_name>=7)
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 6   

 293   2                              alarm.spa_name=0;
 294   2                      alarm.color_mode=(WIFI_CMD[18]-'0');//µÆ¹âµÄ¿ª¹Ø
 295   2                      alarm.color_mode=(WIFI_CMD[18]=='1')?((WIFI_CMD[21]=='1')?COLOR_CHANGE:COLOR_USER):COLOR_OFF;
 296   2                      alarm.userR_val=char_to_hex(WIFI_CMD[23],WIFI_CMD[24]);//RÖµ  
 297   2                      alarm.userG_val=char_to_hex(WIFI_CMD[25],WIFI_CMD[26]);//GÖµ  
 298   2                      alarm.userB_val=char_to_hex(WIFI_CMD[27],WIFI_CMD[28]);//BÖµ  
 299   2                      alarm.Brightness=(WIFI_CMD[31]-'0');//ÁÁ¶È
 300   2                      alarm.volume=char_to_hex(WIFI_CMD[33],WIFI_CMD[34]);//ÒôÁ¿
 301   2                      alarm.play_pause=WIFI_CMD[37]-'0';//ÔÝÍ£²¥·Å
 302   2                      alarm.Enable=(WIFI_CMD[40]-'0');//ÄÖÖÓ×Ü¿ª¹Ø
 303   2                      alarm.Week=char_to_hex(WIFI_CMD[42],WIFI_CMD[43]); 
 304   2                      alarm.Hour=char_to_hex(WIFI_CMD[45],WIFI_CMD[46]);   //ÄÖÖÓÏìµÄÐ¡Ê±µã
 305   2                      alarm.Minute=char_to_hex(WIFI_CMD[48],WIFI_CMD[49]); 
 306   2                      alarm.Duration=char_to_hex(WIFI_CMD[51],WIFI_CMD[52]);//³ÖÐøÏìÁåÊ±¼ä£¬×ª»¯ÎªÊýÖµ
 307   2                      IE3 &= ~0x04;           // Enable WT interrupt
 308   2                      gRTC_Hour  =char_to_hex(WIFI_CMD[54],WIFI_CMD[55]);
 309   2                      gRTC_Minute=char_to_hex(WIFI_CMD[57],WIFI_CMD[58]);
 310   2                      gRTC_Sec   =char_to_hex(WIFI_CMD[60],WIFI_CMD[61]);
 311   2                      gRTC_Week  =WIFI_CMD[73]-'0';
 312   2                      gRTC_Week=Week_Table[gRTC_Week];
 313   2                      IE3 |= 0x04;            // Enable WT interrupt
 314   2                      if((alarm.Enable)&&(!(alarm.Week&0x7F)))
 315   2                       Flag_alarm_wake_only=1;
 316   2                      else
 317   2                       Flag_alarm_wake_only=0;
 318   2              }
 319   1              else if(char_compare(WIFI_CMD,"{AlarmOnOff")==0)
 320   1              {//$$${AlarmOnOff:[00,00,10/21/33/12/01/1D/01]}\r\n
 321   2               //¡·´ú±í Alarm µÄ ID ºÅ 
 322   2               //¡·´ú±íÄÖÖÓµÄ¿ª¹Ø
 323   2               //¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ð°´ÕÕÊ®Áù½øÖÆÊý¼ÓÐ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ÐÇÆÚ£©
 324   2               //      ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëÐÇÆÚ¶þ ÄÇÃ´¸ñÊ½ÊÇ  0a/20/00/12/01/01/02
 325   2               //(WIFI_CMD[11]-'0')  //ProgrammaµÄIDºÅÔÝÊ±Ã»ÓÐ£¬ÎªÒÔºóÀ©Õ¹Ô¤±¸   
 326   2                      alarm.Enable=(WIFI_CMD[17]-'0'); 
 327   2                      IE3 &= ~0x04;           // Enable WT interrupt
 328   2                      gRTC_Hour    =char_to_hex(WIFI_CMD[19],WIFI_CMD[20]);
 329   2                      gRTC_Minute  =char_to_hex(WIFI_CMD[22],WIFI_CMD[23]);
 330   2                      gRTC_Sec     =char_to_hex(WIFI_CMD[25],WIFI_CMD[26]);
 331   2                      gRTC_Week    =WIFI_CMD[38]-'0';
 332   2                      gRTC_Week=Week_Table[gRTC_Week];
 333   2                      IE3 |= 0x04;            // Enable WT interrupt
 334   2                      if((alarm.Enable)&&(!(alarm.Week&0x7F)))
 335   2                       Flag_alarm_wake_only=1;
 336   2                      else
 337   2                       Flag_alarm_wake_only=0;
 338   2              }
 339   1                      else if(char_compare(WIFI_CMD, "Turn on unit")==0) 
 340   1                      {//$$$Turn on unit\r\n
 341   2                              Uart0Transmit_SendString(Uart0_Receive);
 342   2                              if(PlayMode==PLAY_OFF)
 343   2                              {
 344   3                                      GP389_ON();     
 345   3                                      //ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 346   3                                      return;
 347   3                              }
 348   2                      }
 349   1                      else if(char_compare(WIFI_CMD, "Turn on Lightr")==0)
 350   1                      {//$$$Turn on Lightr\r\n
 351   2                              Uart0Transmit_SendString(Uart0_Receive);
 352   2                              if(PlayMode==PLAY_OFF)
 353   2                                      GP389_ON_APP(); 
 354   2                              if(alarm.Runing)//Õâ¸öÒ»¶¨ÊÇ¿ª»ú×´Ì¬²Å½øÈ¥
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 7   

 355   2                              {
 356   3                                      alarm.Runing=0;
 357   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 358   3                              }
 359   2                              color_mode=color_mode_bk;
 360   2                              if(color_mode==COLOR_OFF)
 361   2                                      color_mode=COLOR_WHITE;
 362   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 363   2                              return;
 364   2                      }
 365   1                      else if(char_compare(WIFI_CMD, "Change light color")==0)  
 366   1                      {//$$$Change light color Allplay\r\n
 367   2                              Uart0Transmit_SendString(Uart0_Receive);
 368   2                              if(PlayMode==PLAY_OFF)
 369   2                                      GP389_ON_APP();
 370   2                              if(alarm.Runing)
 371   2                              {//Õâ¸öÒ»¶¨ÊÇ¿ª»úÇé¿öÏÂ½øÈëµÄ
 372   3                                      alarm.Runing=0;
 373   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 374   3                              }
 375   2                              color_mode=COLOR_CHANGE;
 376   2                              play_rgb_index=0;
 377   2                              curR_val=0;
 378   2                              curG_val=0;
 379   2                              curB_val=0;
 380   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 381   2                              return;
 382   2                      } 
 383   1                      else if(char_compare(WIFI_CMD, "User color")==0) 
 384   1                      {//$$$User color FFFFFF\r\n(000000-FFFFFF)
 385   2                              Uart0Transmit_SendString(Uart0_Receive);
 386   2                              if(PlayMode==PLAY_OFF)
 387   2                                      GP389_ON_APP();
 388   2                              if(alarm.Runing)
 389   2                              {
 390   3                                      alarm.Runing=0;
 391   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 392   3                              }
 393   2                              userR_val=char_to_hex(WIFI_CMD[11],WIFI_CMD[12]);
 394   2                              userG_val=char_to_hex(WIFI_CMD[13],WIFI_CMD[14]);
 395   2                              userB_val=char_to_hex(WIFI_CMD[15],WIFI_CMD[16]);
 396   2                              color_mode=COLOR_USER;
 397   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 398   2                              return;
 399   2                      }
 400   1                      else if(char_compare(WIFI_CMD, "Select Sound file")==0) 
 401   1                      {//$$$Select Sound file to play01\r\n
 402   2                              Uart0Transmit_SendString(Uart0_Receive);
 403   2                              if(PlayMode==PLAY_OFF)
 404   2                                      GP389_ON_APP();
 405   2                              if(alarm.Runing)
 406   2                              {
 407   3                                      alarm.Runing=0;
 408   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 409   3                              }
 410   2                              enableMute=0;//½âmute
 411   2                              enable_SPApause=0;
 412   2                              PlayMode=PLAY_MUSIC;
 413   2                              spa_name=WIFI_CMD[26]-'0';
 414   2                              if(cur_spa_name==spa_name)
 415   2                                      spa_cmd=SPA_PALY;
 416   2                              Uart0_SendString_3Step=1;
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 8   

 417   2                              Uart0Transmit_SendString(&SPASongs_Num_Table[spa_name][0]);//Ã¿´Î¸ü¸ÄÒôÀÖ¾Í·¢¸øappÍ¬²½
 418   2                              return;
 419   2                      }
 420   1                      else if(char_compare(WIFI_CMD, "music play")==0)
 421   1                      {//$$$music play\r\n
 422   2                              //Uart0Transmit_SendString(Uart0_Receive);
 423   2                              if(PlayMode==PLAY_OFF)
 424   2                                      GP389_ON_APP();
 425   2                              if(alarm.Runing)
 426   2                              {
 427   3                                      alarm.Runing=0;
 428   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 429   3                              }
 430   2                              PlayMode=PLAY_MUSIC;
 431   2                              enableMute=0;     //½â³ý¾²Òô
 432   2                              enable_SPApause=0;//Îª0±íÊ¾²¥·Å
 433   2                              if(spa_name==SPA_NONE) //spa_nameÎªÃ¶¾Ù±äÁ¿ÀàÐÍ£¬SPA_WHITENOISEÎªÃ¶¾Ù±äÁ¿ÔªËØ
 434   2                                      spa_name=SPA_BRAHM_LULLABY;
 435   2                              else
 436   2                                      spa_cmd=SPA_PALY;                       
 437   2                              /*if(PlayMode==PLAY_BT)
 438   2                              {
 439   2                                      if(flag_bt_play)
 440   2                                      {
 441   2                                              bt_cmd=BT_PALY;//Ð­ÒéÀïÃæÊÇÒ»ÌõÃüÁî£¬ËùÒÔ²¥·Å/ÔÝÍ£¶¼Òª·¢ËÍÕâÌõ
 442   2                                      }
 443   2                              }*/
 444   2                              return;
 445   2                      }
 446   1                      else if(char_compare(WIFI_CMD,"ProPlay\r\n")==0)//½ÓÊÕµ½¾Í²¥·Å×îºóµÄ½ÓÊÕµ½µÄ$$${Program:[00,01,01,00,FFF
             -FFF,03,0A,00,1E]}\r\nÊý¾Ý
 447   1                      {//$$${Program
 448   2                              Uart0Transmit_SendString(Uart0_Receive);
 449   2                              if(PlayMode==PLAY_OFF)
 450   2                                      GP389_ON_APP();
 451   2                              if(alarm.Runing)
 452   2                              {
 453   3                                      alarm.Runing=0;
 454   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 455   3                              }
 456   2                              spa_name=program1.spa_name;
 457   2                              color_mode=program1.color_mode;
 458   2                              userR_val=program1.userR_val;
 459   2                              userG_val=program1.userG_val;
 460   2                              userB_val=program1.userB_val;
 461   2                              Light_Brightness=program1.Light_Brightness;
 462   2                              sys_volume=program1.sys_volume;
 463   2                              PlayMode=program1.PlayMode;
 464   2                              enable_SPApause=program1.enable_SPApause;
 465   2                              program1.enableMute=enableMute=((enable_SPApause==0)?0:1);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔ
             -ÊÐí²¥·Å¾Í²¥·Å
 466   2                              spa_cmd=((enable_SPApause==0)?SPA_PALY:SPA_PAUSE);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔÊÐí²¥·Å¾
             -Í²¥·Å
 467   2                              TimerMode=program1.TimerMode;
 468   2                              return;
 469   2                      } 
 470   1                      else if(char_compare(WIFI_CMD,"{Program")==0)//¹Ø»ú×´Ì¬ÏÂ´ò¿ª
 471   1                      {//$$${Program:[00,01,01,00,FFFFFF,03,0A,00,1E]}\r\n
 472   2                              Uart0Transmit_SendString(Uart0_Receive);
 473   2                              if(PlayMode==PLAY_OFF)
 474   2                                      GP389_ON_APP();
 475   2                              if(alarm.Runing)
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 9   

 476   2                              {
 477   3                                      alarm.Runing=0;
 478   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 479   3                              }
 480   2                              Program1_LaterNum(); //ÏÈ°ÑµÍÊý×Ö¸³¸ø¸ßÊý×Ö£¬
 481   2                              program1.spa_name=spa_name=WIFI_CMD[14]-'0';
 482   2                              program1.color_mode=color_mode=((WIFI_CMD[17]=='1')?COLOR_WHITE:COLOR_OFF);//µÆ¹âµÄ¿ª¹Ø
 483   2                              program1.color_mode=color_mode=((WIFI_CMD[17]=='1')?((WIFI_CMD[20]=='1')?COLOR_CHANGE:COLOR_USER):COLOR
             -_OFF);//ÏÈÅÐ¶ÏÉÏÒ»×éÊÇ·ñ¿ªÆôµÆ¹â£¬Èç¹û¿ªÆôµÆ¹â¾ÍÔÙÅÐ¶ÏÊÇ·ñ¿ªÆô²ÊµÆ£¬Èç¹û²»¿ªÆô¾ÍÊÇÓÃ»§Öµ                                                                                                                                                                                                 //ÓÃ»
             -§ÖµÊÇÏÂÃæRGBµÄÖµ
 484   2                              program1.userR_val=userR_val=char_to_hex(WIFI_CMD[22],WIFI_CMD[23]);
 485   2                              program1.userG_val=userG_val=char_to_hex(WIFI_CMD[24],WIFI_CMD[25]);
 486   2                              program1.userB_val=userB_val=char_to_hex(WIFI_CMD[26],WIFI_CMD[27]);
 487   2                              program1.Light_Brightness=Light_Brightness=char_to_bcd(WIFI_CMD[29],WIFI_CMD[30]);
 488   2                              program1.sys_volume=sys_volume=char_to_hex(WIFI_CMD[32],WIFI_CMD[33]);//ÒôÁ¿
 489   2                              program1.PlayMode=PlayMode=PLAY_MUSIC;
 490   2                              program1.enable_SPApause=enable_SPApause=WIFI_CMD[36]-'0';
 491   2                              program1.enableMute=enableMute=((enable_SPApause==0)?0:1);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔ
             -ÊÐí²¥·Å¾Í²¥·Å
 492   2                              spa_cmd=((enable_SPApause==0)?SPA_PALY:SPA_PAUSE);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔÊÐí²¥·Å¾
             -Í²¥·Å
 493   2                              program1.TimerMode=TimerMode=cntTimer=char_to_hex(WIFI_CMD[38],WIFI_CMD[39]);
 494   2                              return;
 495   2                      }
 496   1                      else if(char_compare(WIFI_CMD,"VER0.\r\n")==0) 
 497   1                      {
 498   2                              return;
 499   2                      }
 500   1                      else if(char_compare(WIFI_CMD,"VER\r\n")==0) 
 501   1                      {
 502   2                              Uart0Transmit_SendString(MCU_VER);//Ã¿´ÎÉý¼¶ÐèÒªÊÖ¶¯¸ÄÐ´ÕâÀï
 503   2                              return;
 504   2                      }
 505   1                      else if(char_compare(WIFI_CMD,"GpSta")==0)
 506   1                      {//×îÖÕ×´Ì¬ÊÇ¹Ø»ú
 507   2                              Uart0_SendString_3Step=0;
 508   2                              cntFlag_ON_OFF=0;
 509   2                              return;//PlayMode=PLAY_OFF;     ÒòÎªÓÐÇ¿ÖÆ¹Ø»ú£¬ËùÒÔ¿ÉÒÔ²»ÒªGP389_OFF()/GP389_ON()
 510   2                      }
 511   1      //              else if(char_compare(WIFI_CMD,"GpSta:[00]\r\n")==0)
 512   1      //              {//×îÖÕ×´Ì¬ÊÇ¿ª»ú£¬
 513   1      //                      Uart0_SendString_3Step=0;
 514   1      //                      cntFlag_ON_OFF=0;
 515   1      //                      return;//PlayMode=PLAY_OFF;     ÒòÎªÓÐÇ¿ÖÆ¹Ø»ú£¬ËùÒÔ¿ÉÒÔ²»ÒªGP389_OFF()/GP389_ON()
 516   1      //              }
 517   1              
 518   1              
 519   1              if(PlayMode!=PLAY_OFF)
 520   1              {
 521   2                      if(char_compare(WIFI_CMD,"{TimeSync")==0)
 522   2                      {//$$${TimeSync:[0A/20/00/12/01/01/02]}\r\n
 523   3      //                      IE3 &= ~0x04;           // Enable WT interrupt
 524   3      //                      gRTC_Hour  =char_to_hex(WIFI_CMD[11],WIFI_CMD[12]);
 525   3      //                      gRTC_Minute=char_to_hex(WIFI_CMD[14],WIFI_CMD[15]);
 526   3      //                      gRTC_Sec   =char_to_hex(WIFI_CMD[17],WIFI_CMD[18]);
 527   3      //                      gRTC_Week  =WIFI_CMD[30]-'0';
 528   3      //                      gRTC_Week  =Week_Table[gRTC_Week];
 529   3      //                      IE3 |= 0x04;            // Enable WT interrupt
 530   3      //                      Falg_TimeSync_Allow=0;//½ÓÊÕµ½Í¬²½ÐÅÏ¢¾Í²»ÔÙ·¢ËÍÇëÇóÍ¬²½£¬ËùÒÔÖÃÎª0
 531   3                              return;
 532   3                      }       
 533   2                      else if(char_compare(WIFI_CMD, "Turn off unit")==0) 
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 10  

 534   2                      {//ÕâÌõÐ­ÒéÃüÁîÊÇappÖ±½Ó·¢ËÍ¹ýÀ´µÄ¹Ø»úÃüÁî£¬²»ÓÃÉêÇë¾Í¿ÉÒÔ¹Ø»ú£¬µ«ÊÇÊÕµ½ÕâÌõÃüÁîÒªÅÐ¶Ï
 535   3                       //´ËÊ±²»ÓÃ½øÐÐÅÐ¶ÏÊÇ²»ÊÇÔÚ¹Ø»ú×´Ì¬£¬ÒòÎª¹Ø»úÖ®ºóÐèÒªÉè¶¨µÄ×´Ì¬¶Ô³ÌÐòÎÞÓ°Ïì£¬»òÕß¿ª»úÖ®
 536   3                       //ºó»á³õÊ¼»¯ÕâÐ©×´Ì¬
 537   3                       //$$$Turn off unit\r\n
 538   3                              Uart0Transmit_SendString(Uart0_Receive);
 539   3                              if(alarm.Runing)
 540   3                              {
 541   4                                      GP389_OFF_AND_AlarmOFF();
 542   4                                      return;
 543   4                              }
 544   3                              
 545   3                              Uart0_SendString_3Step=3;
 546   3                              GP389_OFF();
 547   3                              //ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 548   3                              return;
 549   3                      }
 550   2                      else if(char_compare(WIFI_CMD, "Turn on BT")==0) 
 551   2                      {//$$$Turn on BT\r\n
 552   3                              PlayMode=PLAY_BT;
 553   3                      }
 554   2                      else if(char_compare(WIFI_CMD, "music pause")==0)
 555   2                      {//$$$music pause\r\n
 556   3                              if(PlayMode==PLAY_MUSIC)
 557   3                              {                                   
 558   4                                      enable_SPApause=1;
 559   4                                      spa_cmd=SPA_PAUSE;
 560   4                              }
 561   3      //                      if(PlayMode==PLAY_BT)
 562   3      //                      {
 563   3      //                              if(flag_bt_play) 
 564   3      //                              {
 565   3      //                                      bt_cmd=BT_PAUSE;//Ð­ÒéÀïÃæÊÇÒ»ÌõÃüÁî£¬ËùÒÔ²¥·Å/ÔÝÍ£¶¼Òª·¢ËÍÕâÌõ
 566   3      //                              }
 567   3      //                      }
 568   3                              return;
 569   3                      }
 570   2                      else if(char_compare(WIFI_CMD,"{MusicStatus")==0)
 571   2                      {
 572   3                              return;
 573   3                      }
 574   2                      else if(char_compare(WIFI_CMD, "Adjust Output Volume")==0)
 575   2                      {//$$$Adjust Output Volume01\r\n
 576   3                              if(alarm.Runing)
 577   3                              {
 578   4                                      GP389_OFF_AND_AlarmOFF();
 579   4                                      return;
 580   4                              }
 581   3                              sys_volume=char_to_bcd(WIFI_CMD[20],WIFI_CMD[21]);
 582   3                              enableMute=0;
 583   3                      }
 584   2                      else if(char_compare(WIFI_CMD, "volume up")==0) 
 585   2                      {//$$$volume up\r\n
 586   3                              if(alarm.Runing)
 587   3                              {
 588   4                                      GP389_OFF_AND_AlarmOFF();
 589   4                                      return;
 590   4                              }
 591   3                              sys_volume=((sys_volume < 10)?((sys_volume<=8)?(sys_volume += 2):(sys_volume += 1)):10);
 592   3                              enableMute=0;
 593   3                      }
 594   2                      else if(char_compare(WIFI_CMD, "volume down")==0) 
 595   2                      {//volume down\r\n
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 11  

 596   3                              if(alarm.Runing)
 597   3                              {
 598   4                                      GP389_OFF_AND_AlarmOFF();
 599   4                                      return;
 600   4                              }
 601   3                              sys_volume=((sys_volume > 1)?((sys_volume>=3)?(sys_volume -= 2):(sys_volume -= 1)):1);
 602   3                              enableMute=0;
 603   3                      }
 604   2                      else if(char_compare(WIFI_CMD, "music mute")==0) 
 605   2                      {//$$$music mute\r\n
 606   3                              enableMute=1;
 607   3                              return;
 608   3                      }
 609   2                      else if(char_compare(WIFI_CMD, "music unmute")==0) 
 610   2                      {//$$$music unmute\r\n
 611   3                              enableMute=0;
 612   3                              return;
 613   3                      }
 614   2                      else if(char_compare(WIFI_CMD, "Set Timer")==0)//ok
 615   2                      {//$$$Set Timer 15\r\n(15/30/60)
 616   3                              if(alarm.Runing)
 617   3                              {
 618   4                                      GP389_OFF_AND_AlarmOFF();
 619   4                                      return;
 620   4                              }
 621   3                              TimerMode=cntTimer=char_to_bcd(WIFI_CMD[10],WIFI_CMD[11]);
 622   3                      }
 623   2                      else if(char_compare(WIFI_CMD, "Turn off Timer")==0)//ok
 624   2                      {//$$$Turn off Timer\r\n
 625   3                              if(alarm.Runing)
 626   3                              {
 627   4                                      GP389_OFF_AND_AlarmOFF();
 628   4                                      return;
 629   4                              }
 630   3                              TimerMode=cntTimer=TIMER_OFF;
 631   3                      }
 632   2                      else if(char_compare(WIFI_CMD, "Turn off Lightr")==0)  
 633   2                      {//$$$Turn off Lightr\r\n
 634   3                              if(alarm.Runing)
 635   3                              {
 636   4                                      GP389_OFF_AND_AlarmOFF();
 637   4                                      return;
 638   4                              }
 639   3                              color_mode=COLOR_OFF;
 640   3                      } 
 641   2                      else if(char_compare(WIFI_CMD,"light up")==0)
 642   2                      {//$$$light up\r\n
 643   3                              if(alarm.Runing)
 644   3                              {
 645   4                                      GP389_OFF_AND_AlarmOFF();
 646   4                                      return;
 647   4                              }
 648   3                              if(Light_Brightness<3)
 649   3                                      Light_Brightness++;
 650   3                      }
 651   2                      else if(char_compare(WIFI_CMD,"light down")==0)
 652   2                      {//$$$light down\r\n
 653   3                              if(alarm.Runing)
 654   3                              {
 655   4                                      GP389_OFF_AND_AlarmOFF();
 656   4                                      return;
 657   4                              }
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 12  

 658   3                              if(Light_Brightness>0)
 659   3                                      Light_Brightness--;
 660   3                      }
 661   2                      else if(char_compare(WIFI_CMD,"Adjust Light Brightness")==0)
 662   2                      {//$$$Adjust Light Brightness 01\r\n(01-03)
 663   3                              if(alarm.Runing)
 664   3                              {
 665   4                                      GP389_OFF_AND_AlarmOFF();
 666   4                                      return;
 667   4                              }
 668   3                              Light_Brightness=char_to_bcd(WIFI_CMD[24],WIFI_CMD[25]);
 669   3                      }
 670   2                      else if(char_compare(WIFI_CMD,"AlaGpSta\r\n")==0) 
 671   2                      {//W-G:"$$$AlaGpSta\r\n"
 672   3                       //G-W:"$$${AlaGpSta:[00,01,01,00,FFFFFF,03,0A,00,01,FF,17:3B,FF]}\r\n"
 673   3                       //Êý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨13¸ö×Ö¶Î£©·Ö±ð±íÊ¾£
             -º
 674   3                       //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓÐÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 675   3                       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 676   3                       //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 677   3                       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 678   3                       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 679   3                       //¡·´ú±íÁÁ¶È( 00 - 03 )
 680   3                       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 681   3                       //¡·´ú±íÔÝÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õý³£²¥·Å,01±íÊ¾ÔÝÍ£²¥·Å£©
 682   3                       //£¨È¥µô£©¡·´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 683   3                       //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 684   3                       //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 685   3                       //    0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 686   3                       //    0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 687   3                       //    0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 688   3                       //    BIT            7       6    5    4    3    2    1    0
 689   3                       //    ÐÇÆÚx   repeat  ÈÕ  Áù  Îå  ËÄ  Èý  ¶þ  Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î£¬ÕâÒ»´Î
 690   3                       //  ÊÇÆßÌìÖ®ÄÚµÄ£¬¼ÙÈç¶¨Ê±13:00£¬²»ÖØ¸´£¬ÄÇÕâ´Î¼ÆÊ±µ½(7*24*60-1)minÖ®ºó½áÊø£¬¼´ÆßÌìÖ®ºó
 691   3                       //  µÄ12:59·Ö£©
 692   3                       //¡·´ú±íÄÖÖÓ¶¨Ê±Ê±¼äµã£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 693   3                       //¡·´ú±íÏìÁåÊ±¼ä£¨charÀàÐÍ1¸ö×Ö½Ú£©00-FF (µ¥Î»:·ÖÖÓ)
 694   3                       //£¨È¥µô£©¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ð°´ÕÕÊ®Áù½øÖÆÊý¼ÓÐ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ÐÇÆÚ£© 
 695   3                       //    ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëÐÇÆÚ¶þ ÄÇÃ´¸ñÊ½ÊÇ 0a/20/00/12/01/01/02
 696   3                              char  code respAlaGpSta[]={"$$${AlaGpSta:[00,00,00,00,000000,00,00,00,00,00,00:00,00]}\r\n"};
 697   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 698   3                                      Uart0_Receive[i]=0x00;
 699   3                              for(i=0;i<62;i++)
 700   3                                      Uart0_Receive[i]=respAlaGpSta[i];
 701   3                              hex_to_char(&Uart0_Receive[14],0);//IDºÅÄ¬ÈÏÎª0
 702   3                              hex_to_char(&Uart0_Receive[17],((alarm.spa_name!=0)?alarm.spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ
             -£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 703   3                              hex_to_char(&Uart0_Receive[20],((alarm.color_mode==COLOR_OFF)?0:1));//¿ª¹ØµÆ
 704   3                              hex_to_char(&Uart0_Receive[23],(((alarm.color_mode==COLOR_CHANGE)?1:0)));//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½
             -£©
 705   3                              hex_to_char(&Uart0_Receive[26],alarm.userR_val);
 706   3                              hex_to_char(&Uart0_Receive[28],alarm.userG_val);
 707   3                              hex_to_char(&Uart0_Receive[30],alarm.userB_val);
 708   3                              hex_to_char(&Uart0_Receive[33],alarm.Brightness);//ÁÁ¶È
 709   3                              hex_to_char(&Uart0_Receive[36],alarm.volume);//ÒôÁ¿
 710   3                              hex_to_char(&Uart0_Receive[39],alarm.play_pause);
 711   3                              hex_to_char(&Uart0_Receive[42],alarm.Enable);
 712   3                              hex_to_char(&Uart0_Receive[45],alarm.Week);
 713   3                              hex_to_char(&Uart0_Receive[48],alarm.Hour);
 714   3                              hex_to_char(&Uart0_Receive[51],alarm.Minute);
 715   3                              hex_to_char(&Uart0_Receive[54],alarm.Duration);
 716   3                              Uart0_SendString_3Step=2;
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 13  

 717   3                      }
 718   2                      else if(char_compare(WIFI_CMD,"NorGpSta\r\n")==0)
 719   2                      {//W-G:"$$$NorGpSta\r\n"
 720   3                       //G-W:"$$${NorGpSta:[00,00,01,01,FFFFFF,03,0A,00,1E]}\r\n"
 721   3                              char  code respNorGpSta[]={"$$${NorGpSta:[00,00,00,00,000000,00,00,00,00]}\r\n"};
 722   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 723   3                                      Uart0_Receive[i]=0x00;
 724   3                              for(i=0;i<48;i++)
 725   3                                      Uart0_Receive[i]=respNorGpSta[i];
 726   3                              hex_to_char(&Uart0_Receive[14],1);//ÔÚÕâÀïÊÇ¿ª»ú
 727   3                              hex_to_char(&Uart0_Receive[17],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬Ê
             -ÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 728   3                              hex_to_char(&Uart0_Receive[20],(color_mode==COLOR_OFF)?0:1);
 729   3                              hex_to_char(&Uart0_Receive[23],(color_mode==COLOR_CHANGE)?0:1);//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½£©
 730   3                              hex_to_char(&Uart0_Receive[26],userR_val);
 731   3                              hex_to_char(&Uart0_Receive[28],userG_val);
 732   3                              hex_to_char(&Uart0_Receive[30],userB_val);
 733   3                              hex_to_char(&Uart0_Receive[33],Light_Brightness);
 734   3                              hex_to_char(&Uart0_Receive[36],sys_volume);
 735   3                              hex_to_char(&Uart0_Receive[39],enable_SPApause);
 736   3                              hex_to_char(&Uart0_Receive[42],cntTimer);
 737   3                              Uart0_SendString_3Step=2;
 738   3                      }
 739   2                      else if(char_compare(WIFI_CMD," update")==0) 
 740   2                      {//mcu update+0X43A4+0X0044,½ÓÊÕµ½Õâ¸öÐÅÏ¢¿ªÊ¼Éý¼¶
 741   3                              Update_ByteSizeSum=(char_to_hex(WIFI_CMD[10],WIFI_CMD[11])<<8)|char_to_hex(WIFI_CMD[12],WIFI_CMD[13]);/
             -/¶àÉÙ¸ö×Ö½Ú£¬µØÎ»ÔÚÇ°£¬¸ßÎ»ÔÚºó
 742   3                              Update_PacketSum  =(char_to_hex(WIFI_CMD[17],WIFI_CMD[18])<<8)|char_to_hex(WIFI_CMD[19],WIFI_CMD[20]);/
             -/¶àÉÙ¸ö°ü
 743   3                              update_handle();
 744   3                      }
 745   2                      else if(char_compare(WIFI_CMD,"ATWQ\r\n")==0) 
 746   2                      {//$$$ATWQ\r\n
 747   3                              Uart0_SendString_3Step=0;
 748   3                              return;
 749   3                      }
 750   2                      else if(char_compare(WIFI_CMD,"VER\r\n")==0) 
 751   2                      {
 752   3                              Uart0Transmit_SendString(MCU_VER);//Ã¿´ÎÉý¼¶ÐèÒªÊÖ¶¯¸ÄÐ´ÕâÀï
 753   3                              return;
 754   3                      }
 755   2                      else if(char_compare(WIFI_CMD,"Enter TestMode:")==0) 
 756   2                      {
 757   3                              Uart0_SendString_3Step=0;
 758   3                              cntFlash=0;
 759   3                              Led_Flash=0;
 760   3                              setFactory=1;//ÖÃÒ»ÈÃÈý¸ötimerµÆ³£ÁÁÈýÃë
 761   3                              PlayMode=PLAY_ON;
 762   3                              bt_send_cmd(BT_CLEAR_LIST);//Çå³ýÀ¶ÑÀÁÐ±íÁÐ±í
 763   3                              return;
 764   3                      }
 765   2                      Uart0Transmit_SendString(Uart0_Receive);
 766   2                      ////////////////////////////////////////////////////////////////////////////////////
 767   2                      ////////////////////////////////////////////////////////////////////////////////////
 768   2              }
 769   1              else //¹Ø»ú×´Ì¬ÏÂ½ÓÊÕÌØ¶¨wifiÊý¾Ý
 770   1              {
 771   2                      if(char_compare(WIFI_CMD,"{NorGpSta")==0)
 772   2                      {//W-G:"$$$NorGpSta\r\n"
 773   3                       //G-W:"$$${NorGpSta:[00,00,01,01,FFFFFF,03,0A,00,1E]}\r\n"
 774   3                              char  code respNorGpSta[]={"$$${NorGpSta:[00,00,00,00,000000,00,00,00,00]}\r\n"};
 775   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
C51 COMPILER V9.00   WIFI_MODE                                                             08/06/2018 15:52:18 PAGE 14  

 776   3                                      Uart0_Receive[i]=0x00;
 777   3                              for(i=0;i<48;i++)
 778   3                                      Uart0_Receive[i]=respNorGpSta[i];
 779   3                              hex_to_char(&Uart0_Receive[14],0);//ÔÚÕâÀïÊÇ¿ª»ú
 780   3                              hex_to_char(&Uart0_Receive[17],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬Ê
             -ÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 781   3                              hex_to_char(&Uart0_Receive[20],(color_mode==COLOR_OFF)?0:1);
 782   3                              hex_to_char(&Uart0_Receive[23],(color_mode==COLOR_CHANGE)?0:1);//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½£©
 783   3                              hex_to_char(&Uart0_Receive[26],userR_val);
 784   3                              hex_to_char(&Uart0_Receive[28],userG_val);
 785   3                              hex_to_char(&Uart0_Receive[30],userB_val);
 786   3                              hex_to_char(&Uart0_Receive[33],Light_Brightness);
 787   3                              hex_to_char(&Uart0_Receive[36],sys_volume);
 788   3                              hex_to_char(&Uart0_Receive[39],enable_SPApause);
 789   3                              hex_to_char(&Uart0_Receive[42],cntTimer);
 790   3                              Uart0_SendString_3Step=2;
 791   3                      }
 792   2                      Uart0Transmit_SendString(Uart0_Receive);
 793   2              }
 794   1      }
 795          
 796          void Program1_LaterNum()
 797          {
 798   1              program3=program2;//ÒòÎªÊý¾ÝºÍÊý¾ÝÀàÐÍÍêÈ«Ò»Ñù£¬ËùÒÔ¿ÉÒÔÖ±½Ó¸³Öµ
 799   1              program2=program1;
 800   1      }
 801          
 802          
 803          
 804          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4951    ----
   CONSTANT SIZE    =    855    ----
   XDATA SIZE       =   ----      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
