C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE WIFI_MODE
OBJECT MODULE PLACED IN .\Objects\wifi_mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE source\wifi_mode.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\
                    -include) DEBUG OBJECTEXTEND PRINT(.\Listings\wifi_mode.lst) OBJECT(.\Objects\wifi_mode.obj)

line level    source

   1          //Í·ÎÄ¼þheader file//
   2          #include "app_main.h"
   3          
   4          //ºê¶¨Òåmacro definition//
   5          
   6          //ÀàÐÍ¶¨Òåbyte definition//
   7          
   8          //±äÁ¿¶¨Òåvariable definition//
   9          uint8_t  code Week_Table[]={0x01,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};
  10          
  11          char  code SPASongs_Num_Table[7][24]= 
  12          {
  13                  "$$${MusicStatus:[07]}\r\n",
  14                  "$$${MusicStatus:[01]}\r\n",
  15                  "$$${MusicStatus:[02]}\r\n",
  16                  "$$${MusicStatus:[03]}\r\n",
  17                  "$$${MusicStatus:[04]}\r\n",
  18                  "$$${MusicStatus:[05]}\r\n",
  19                  "$$${MusicStatus:[06]}\r\n",
  20          };
  21          
  22          //±êÖ¾Î´¶¨Òåflags definetion//
  23          
  24          //º¯ÊýÉùÃ÷Function declaration//
  25          void Program1_LaterNum();
  26          
  27          //º¯Êý¶¨Òåfunction definetion//
  28          /*******************************************************************
  29          º¯ÊýÔ­ÐÍ£º
  30          ÊäÈë²ÎÊý£º
  31          Êä³ö²ÎÊý£º
  32          º¯Êý¹¦ÄÜ£º±È½Ï»ñµÃµÄ¿ØÖÆÖ¸ÁîÓëÔ¤ÏÈÉè¶¨µÄÖ¸Áî¶Ô±ÈÊÇ·ñÒ»ÖÂ£¬Èç¹ûÒ»ÖÂ¾ÍÖ´ÐÐÏà¹Ø¹¦ÄÜ£¬·ñÔòÎÞ²Ù×÷
  33          *******************************************************************/
  34          uint8_t char_compare( char *source,  char *dest)
  35          {
  36   1              while(*dest)
  37   1              {       
  38   2                      if((*source!=*dest)||(*source==0)||(*dest==0))
  39   2                              return 1;
  40   2                      source++;
  41   2                      dest++;
  42   2              }
  43   1              return 0;
  44   1      }
  45          
  46          /*******************************************************************
  47          º¯ÊýÔ­ÐÍ£º
  48          ÊäÈë²ÎÊý£º
  49          Êä³ö²ÎÊý£º
  50          º¯Êý¹¦ÄÜ£º°Ñ×Ö·û×ª»¯Îª´úÂë
  51          *******************************************************************/
  52          char char_to_hex(char indata1,char indata2)
  53          {
  54   1              if(indata1>='A')
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 2   

  55   1                      indata1=((indata1-'A')+0x0A);
  56   1              else
  57   1                      indata1=(indata1-'0');
  58   1              if(indata2>='A')
  59   1                      indata2=((indata2-'A')+0x0A);
  60   1              else
  61   1                      indata2=(indata2-'0');
  62   1              return ((indata1<<4)|indata2);
  63   1      }
  64          
  65          /*******************************************************************
  66          º¯ÊýÔ­ÐÍ£º
  67          ÊäÈë²ÎÊý£º
  68          Êä³ö²ÎÊý£º
  69          º¯Êý¹¦ÄÜ£º°Ñ×Ö·û×ª»¯Îª´úÂë
  70          *******************************************************************/
  71          char char_to_bcd(char indata1,char indata2)
  72          {
  73   1              if(indata1>='A')
  74   1                      indata1=((indata1-'A')+0x0A);
  75   1              else
  76   1                      indata1=(indata1-'0');
  77   1              if(indata2>='A')
  78   1                      indata2=((indata2-'A')+0x0A);
  79   1              else
  80   1                      indata2=(indata2-'0');
  81   1              return (indata1*10+indata2);
  82   1      }
  83          
  84          /*******************************************************************
  85          º¯ÊýÔ­ÐÍ£º
  86          ÊäÈë²ÎÊý£º
  87          Êä³ö²ÎÊý£º
  88          º¯Êý¹¦ÄÜ£º°ÑÒª·¢ËÍµÄÐ­Òé×ª»¯Îª×Ö·û
  89          *******************************************************************/
  90          void hex_to_char(uint8_t *p,uint8_t indata)
  91          {
  92   1              uint8_t tmp;
  93   1              tmp=indata>>4;
  94   1              if(tmp>=0x0A)
  95   1               *p=((tmp-0x0A)+'A'); 
  96   1              else
  97   1               *p=(tmp+'0');
  98   1              p++;
  99   1              tmp=indata&0x0F;
 100   1              if(tmp>=0x0A)
 101   1                      *p=((tmp-0x0A)+'A'); 
 102   1              else
 103   1                      *p=(tmp+'0');
 104   1      }
 105          
 106          /*******************************************************************
 107          º¯ÊýÔ­ÐÍ£º
 108          ÊäÈë²ÎÊý£º
 109          Êä³ö²ÎÊý£º
 110          º¯Êý¹¦ÄÜ£º¿ª»úÒª·¢ËÍµÄÃüÁîºÍÏà¹Ø²Ù×÷£¬Õâ¸ö¿ª»úÊÇ°´¼ü°´ÏÂ¿ª»úºÍ½ÓÊÕµ½¡°turn on¡±¿ª»ú£¬
 111                    ÆäËûapp·¢ËÍÑÕÉ«²¢¿ª»úÊ±GP389_ON_APP()º¯Êý
 112          *******************************************************************/
 113          void GP389_ON(void) //
 114          {
 115   1              PlayMode=PLAY_ON;
 116   1              PlayMode=((PlayMode_bk==PLAY_MUSIC)?PLAY_MUSIC:PLAY_ON);//Èç¹û¹Ø»úÊ±ÊÇmusicÄ£Ê½£¬¿ª»ú»Ø¸´´ËÄ£Ê½
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 3   

 117   1              sys_volume=sys_volume_bk;
 118   1              color_mode=color_mode_bk;
 119   1              //Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);//¹Ø»úÖ®Ç°Èç¹ûÁÁ¶ÈÎª0¾Í»Ö¸´Îª1£¬·ñÔòÎª¹Ø»úÖ
             -®Ç°ÁÁ¶È//2018.4.9¹Ø»úÖ®Ç°ÁÁ¶ÈÎª0£¬¿ª»úÒ²Îª0
 120   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 121   1              
 122   1              Uart0_SendString_3Step=3;
 123   1      }
 124          
 125          /*******************************************************************
 126          º¯ÊýÔ­ÐÍ£º
 127          ÊäÈë²ÎÊý£º
 128          Êä³ö²ÎÊý£º
 129          º¯Êý¹¦ÄÜ£ºapp·¢ËÍÑÕÉ«¡¢µÆ¹â¡¢ÒôÀÖ¸ø»úÌ¨£¨´ËÊ±»úÌ¨Îª¹Ø»ú×´Ì¬£©£¬È»ºó¿ª»ú£¬³ýÁËÒôÁ¿ÆäËû²»»Ö¸´£¬
 130                    Ö»½ÓÊÜÐÂµÄ¹¦ÄÜ²Ù×÷(ÑÕÉ«¡¢µÆ¹â¡¢ÒôÀÖ)
 131          *******************************************************************/
 132          void GP389_ON_APP(void) //
 133          {
 134   1              PlayMode=PLAY_ON;
 135   1              sys_volume=sys_volume_bk;
 136   1              //Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);//¹Ø»úÖ®Ç°Èç¹ûÁÁ¶ÈÎª0¾Í»Ö¸´Îª1£¬·ñÔòÎª¹Ø»úÖ
             -®Ç°ÁÁ¶È//2018.4.9¹Ø»úÖ®Ç°ÁÁ¶ÈÎª0£¬¿ª»úÒ²Îª0
 137   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 138   1              Uart0_SendString_3Step=3;
 139   1      }
 140          
 141          /*******************************************************************
 142          º¯ÊýÔ­ÐÍ£º
 143          ÊäÈë²ÎÊý£º
 144          Êä³ö²ÎÊý£º
 145          º¯Êý¹¦ÄÜ£º°´¼ü¹Ø»úºÍapp¿ØÖÆ¹Ø»úÖ´ÐÐµÄ
 146          *******************************************************************/
 147          void GP389_OFF(void) //
 148          {
 149   1              PlayMode_bk=PlayMode;
 150   1              PlayMode=PLAY_OFF;
 151   1              sys_volume_bk=sys_volume;
 152   1              color_mode_bk=color_mode;
 153   1              color_mode=COLOR_OFF;
 154   1              TimerMode=cntTimer=TIMER_OFF;//
 155   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 156   1              Uart0_SendString_3Step=3;
 157   1      }
 158          
 159          /*******************************************************************
 160          º¯ÊýÔ­ÐÍ£º
 161          ÊäÈë²ÎÊý£º
 162          Êä³ö²ÎÊý£º
 163          º¯Êý¹¦ÄÜ£ºÄÖÖÓÔÚÏìÓ¦Ê±²Ù×÷ÔÚAPPÉÏµ÷ÁËµÆ¹âÁÁ¶È£¬ÒôÁ¿´óÐ¡£¬Ôò¹Ø±ÕÄÖÁå²¢¹Ø»ú£¬ÔÚappÉÏµãÁËÌØ¶¨
 164                    ÑÕÉ«µÄµÆ¹â£¬»òÕßµãÁËÌØ¶¨ÒôÀÖ£¬»òÕßµãÁËprogram,ÄÇÃ´ÄÖÖÓÍ£Ö¹£¬ÏìÓ¦ËùµãµÄ²Ù×÷
 165          *******************************************************************/
 166          void GP389_OFF_AND_AlarmOFF()
 167          {
 168   1              alarm.Runing=0;
 169   1              gbKeyNone=0;
 170   1              GP389_OFF();
 171   1              //color_mode=COLOR_OFF;
 172   1              Uart0_SendString_3Step=5;
 173   1              ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);       
 174   1              TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF;    
 175   1              return;
 176   1      }
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 4   

 177          
 178          /*******************************************************************
 179          º¯ÊýÔ­ÐÍ£º
 180          ÊäÈë²ÎÊý£º
 181          Êä³ö²ÎÊý£º
 182          º¯Êý¹¦ÄÜ£ºÉêÇë¿ª¹Ø»úÊ±µ÷ÓÃ´Ëº¯Êý
 183          *******************************************************************/
 184          void ApplicationGP389_ONOFF(uint8_t onoff)
 185          {//$$${GpSta:[00,00,01,01,FFFFFF,03,0A,00,1E;00,01,00,FFFFFF,03,0A,01,FF,17:3B,FF]}\r\n
 186   1       //Êý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨Ç°10¸ö×Ö¶Î£©·Ö±ð±íÊ¾£
             -º
 187   1       //¡·ÊÇ·ñ¹Ø»ú,00ÊÇ¿ª»ú£¬01ÊÇ¹Ø»ú
 188   1       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 189   1       //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 190   1       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 191   1       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 192   1       //¡·´ú±íÁÁ¶È( 00 - 03 )
 193   1       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0A )
 194   1       //¡·´ú±íÔÝÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õý³£²¥·Å,01±íÊ¾ÔÝÍ£²¥·Å£©
 195   1       //¡·´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 196   1       //¡·Ó¢ÎÄ·ÖºÅ¡°;¡±¸ô¿ªÕâÁ½²¿·ÖÃüÁî
 197   1       //¡·ÄÖÖÓ¿ØÖÆÐÅÏ¢£ºÊý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨10¸ö×
             -Ö¶Î£©·Ö±ð±íÊ¾£º
 198   1       //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓÐÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 199   1       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 200   1       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 201   1       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 202   1       //¡·´ú±íÁÁ¶È( 00 - 03 )
 203   1       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 204   1       //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 205   1       //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 206   1       //  0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 207   1       //  0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 208   1       //  0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 209   1       //  BIT            7       6    5    4    3    2    1    0
 210   1       //  ÐÇÆÚx   repeat  ÈÕ  Áù  Îå  ËÄ  Èý  ¶þ  Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î£¬ÕâÒ»´Î
 211   1       //  ÊÇÆßÌìÖ®ÄÚµÄ£¬¼ÙÈç¶¨Ê±13:00£¬²»ÖØ¸´£¬ÄÇÕâ´Î¼ÆÊ±µ½(7*24*60-1)minÖ®ºó½áÊø£¬¼´ÆßÌìÖ®ºó
 212   1       //  µÄ12:59·Ö£©
 213   1       //¡·´ú±íÄÖÖÓÊ±¼ä£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 214   1       //¡·´ú±íÏìÁåÊ±¼ä£¨charÀàÐÍ1¸ö×Ö½Ú£©00-FF (µ¥Î»:·ÖÖÓ)
 215   1              char i;
 216   1              char code respGP389_AllSta[]={"$$${GpSta:[00,00,00,00,000000,00,00,00,00;00,00,00,000000,00,00,00,00,00:0
             -0,00]}\r\n"};
 217   1              do{WDT_clear();} while(Uart0_EnableSend);
 218   1              Count200ms_3Step=0;
 219   1              //Uart0_SendString_3Step=0;
 220   1              for(i=0;i<UART0_LEN_BUFFER;i++)
 221   1                      Uart0_TransmitBuffer[i]=0x00;
 222   1              for(i=0;i<82;i++)
 223   1                      Uart0_TransmitBuffer[i]=respGP389_AllSta[i];
 224   1              hex_to_char(&Uart0_TransmitBuffer[11],onoff);
 225   1              hex_to_char(&Uart0_TransmitBuffer[14],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹û
             -ÊÇ£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 226   1              hex_to_char(&Uart0_TransmitBuffer[17],((color_mode==COLOR_OFF)?0:1));//Îª1Ê±ÊÇÒª¹Ø»ú£¬ËùÒÔÒªºÍcolor_mode_
             -bk¶Ô±È£¬Îª0ÊÇÒª¿ª»ú£¬ÒÑ¾­°Ñcolor_mode_bk¸³Öµ¸øcolor_mode
 227   1              hex_to_char(&Uart0_TransmitBuffer[20],((color_mode==COLOR_CHANGE)?1:0));
 228   1              hex_to_char(&Uart0_TransmitBuffer[23],userR_val);
 229   1              hex_to_char(&Uart0_TransmitBuffer[25],userG_val);       
 230   1              hex_to_char(&Uart0_TransmitBuffer[27],userB_val);
 231   1              hex_to_char(&Uart0_TransmitBuffer[30],Light_Brightness);
 232   1              hex_to_char(&Uart0_TransmitBuffer[33],sys_volume);
 233   1              hex_to_char(&Uart0_TransmitBuffer[36],enable_SPApause);
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 5   

 234   1              hex_to_char(&Uart0_TransmitBuffer[39],cntTimer);
 235   1              hex_to_char(&Uart0_TransmitBuffer[42],00);//ÄÖÖÓIDºÅÄ¬ÈÏÎª0
 236   1              hex_to_char(&Uart0_TransmitBuffer[45],alarm.spa_name);//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²
             -»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 237   1              hex_to_char(&Uart0_TransmitBuffer[48],((alarm.color_mode==COLOR_CHANGE)?1:0));//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ
             -£Ê½£©
 238   1              hex_to_char(&Uart0_TransmitBuffer[51],alarm.userR_val);
 239   1              hex_to_char(&Uart0_TransmitBuffer[53],alarm.userG_val); 
 240   1              hex_to_char(&Uart0_TransmitBuffer[55],alarm.userB_val);
 241   1              hex_to_char(&Uart0_TransmitBuffer[58],alarm.Brightness);//ÁÁ¶È
 242   1              hex_to_char(&Uart0_TransmitBuffer[61],alarm.volume);//ÒôÁ¿
 243   1              hex_to_char(&Uart0_TransmitBuffer[64],alarm.Enable); //ÄÖÖÓ×Ü¿ª¹Ø
 244   1              hex_to_char(&Uart0_TransmitBuffer[67],alarm.Week);  //ÄÖÖÓÖÜ¼¸ÏìµÍ4Î»
 245   1              hex_to_char(&Uart0_TransmitBuffer[70],alarm.Hour);  //ÄÖÖÓ¶¨Ê±µÄÊ±¼ä£¬Ð¡Ê±µÍËÄÎ»
 246   1              hex_to_char(&Uart0_TransmitBuffer[73],alarm.Minute);//ÄÖÖÓ¶¨Ê±µÄÊ±¼ä£¬·ÖÖÓµÍËÄÎ»
 247   1              hex_to_char(&Uart0_TransmitBuffer[76],alarm.Duration);//ÄÖÖÓÏìÁåÊ±¼ä£¬µÍËÄÎ»
 248   1              Uart0_SendString_3Step=2;
 249   1              Uart0_Tx_Pointer=0;
 250   1              Uart0_EnableSend=1;
 251   1              Uart0_Tx_TimeOut=10;    
 252   1              USI0DR=Uart0_TransmitBuffer[Uart0_Tx_Pointer++];
 253   1              if(cntFlag_ON_OFF==0)
 254   1                      cntFlag_ON_OFF=2;
 255   1      }
 256          
 257          /*******************************************************************
 258          º¯ÊýÔ­ÐÍ£º
 259          ÊäÈë²ÎÊý£º
 260          Êä³ö²ÎÊý£º
 261          º¯Êý¹¦ÄÜ£º´®¿Ú½ÓÊÕµ½µÄÃüÁîÐ­ÒéºÍÔ¤¶¨µÄÐ­Òé¶Ô±ÈÈ·¶¨ÊÇÄÄ¸ö½ø¶øÖ´ÐÐ²Ù×÷£¬·ñÔòÎÞ²Ù×÷
 262          *******************************************************************/
 263          void Wifi_CommandDeal(char *Uart0_Receive)
 264          {
 265   1              uint8_t i;
 266   1              char *WIFI_CMD;
 267   1              WIFI_CMD=&Uart0_Receive[3];
 268   1              if(char_compare(WIFI_CMD,"{AlarmSet")==0)//ok
 269   1              {//$$${AlarmSet:[00,01,00,01,FFFFFF,03,0A,00,00,FF,17:3B,FF,0a/20/00/12/01/01/02]}\r\n
 270   2               //Êý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨10¸ö×Ö¶Î£©·Ö±ð±íÊ¾£º
 271   2               //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓÐÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 272   2               //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 273   2               //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 274   2               //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·,£©
 275   2               //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 276   2               //¡·£¨È¥µô£©´ú±íµÆÑÕÉ«µÄÏÂ±ê£¬Óëapp½çÃæÖÐµÆÒ»ÖÂ£¬·½±ãµÆ×´Ì¬Í¬²½ÔÆ¶ËºÍapp£¨00-0B£©,ÆäÖÐ00´ú±í¹ØµÆ£¬0A´ú±í
             -²ÊµÆ£¬0B´ú±í×Ô¶¨ÒåÑÕÉ«
 277   2               //¡·´ú±íÁÁ¶È( 00 - 03 )
 278   2               //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 279   2               //¡·´ú±íÔÝÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õý³£²¥·Å,01±íÊ¾ÔÝÍ£²¥·Å£©
 280   2               //¡·(È¥µô)£º´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 281   2               //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 282   2               //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 283   2               //  0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 284   2               //  0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 285   2               //  0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 286   2               //  BIT      7       6    5    4    3    2    1    0
 287   2               //  ÐÇÆÚx  repeat    ÈÕ   Áù   Îå    ËÄ   Èý   ¶þ   Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î
 288   2               //¡·´ú±íÄÖÖÓ¶¨Ê±Ê±¼äµã£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 289   2               //¡·´ú±íÏìÁåÊ±¼ä£¨intÀàÐÍ4¸ö×Ö½Ú£©00-FF (µ¥Î»ÓÉÇ¿´ó¶¨Òå)
 290   2               //¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ð°´ÕÕÊ®Áù½øÖÆÊý¼ÓÐ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ÐÇÆÚ£©
 291   2               //  ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëÐÇÆÚ¶þ ÄÇÃ´¸ñÊ½ÊÇ 0a/20/00/12/01/01/02
 292   2               //(WIFI_CMD[11]-'0')  //ProgrammaµÄIDºÅÔÝÊ±Ã»ÓÐ£¬ÎªÒÔºóÀ©Õ¹Ô¤±¸   
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 6   

 293   2                      alarm.spa_name  =(WIFI_CMD[15]-'0');//µÚ¼¸Ê×¸è
 294   2                      if(alarm.spa_name>=7)
 295   2                              alarm.spa_name=0;
 296   2                      alarm.color_mode=(WIFI_CMD[18]-'0');//µÆ¹âµÄ¿ª¹Ø
 297   2                      alarm.color_mode=(WIFI_CMD[18]=='1')?((WIFI_CMD[21]=='1')?COLOR_CHANGE:COLOR_USER):COLOR_OFF;
 298   2                      alarm.userR_val=char_to_hex(WIFI_CMD[23],WIFI_CMD[24]);//RÖµ  
 299   2                      alarm.userG_val=char_to_hex(WIFI_CMD[25],WIFI_CMD[26]);//GÖµ  
 300   2                      alarm.userB_val=char_to_hex(WIFI_CMD[27],WIFI_CMD[28]);//BÖµ  
 301   2                      alarm.Brightness=(WIFI_CMD[31]-'0');//ÁÁ¶È
 302   2                      alarm.volume=char_to_hex(WIFI_CMD[33],WIFI_CMD[34]);//ÒôÁ¿
 303   2                      alarm.play_pause=WIFI_CMD[37]-'0';//ÔÝÍ£²¥·Å
 304   2                      alarm.Enable=(WIFI_CMD[40]-'0');//ÄÖÖÓ×Ü¿ª¹Ø
 305   2                      alarm.Week=char_to_hex(WIFI_CMD[42],WIFI_CMD[43]); 
 306   2                      alarm.Hour=char_to_hex(WIFI_CMD[45],WIFI_CMD[46]);   //ÄÖÖÓÏìµÄÐ¡Ê±µã
 307   2                      alarm.Minute=char_to_hex(WIFI_CMD[48],WIFI_CMD[49]); 
 308   2                      alarm.Duration=char_to_hex(WIFI_CMD[51],WIFI_CMD[52]);//³ÖÐøÏìÁåÊ±¼ä£¬×ª»¯ÎªÊýÖµ
 309   2                      IE3 &= ~0x04;           // Enable WT interrupt
 310   2                      gRTC_Hour  =char_to_hex(WIFI_CMD[54],WIFI_CMD[55]);
 311   2                      gRTC_Minute=char_to_hex(WIFI_CMD[57],WIFI_CMD[58]);
 312   2                      gRTC_Sec   =char_to_hex(WIFI_CMD[60],WIFI_CMD[61]);
 313   2                      gRTC_Week  =WIFI_CMD[73]-'0';
 314   2                      gRTC_Week=Week_Table[gRTC_Week];
 315   2                      IE3 |= 0x04;            // Enable WT interrupt
 316   2                      if((alarm.Enable)&&(!(alarm.Week&0x7F)))
 317   2                       Flag_alarm_wake_only=1;
 318   2                      else
 319   2                       Flag_alarm_wake_only=0;
 320   2              }
 321   1              else if(char_compare(WIFI_CMD,"{AlarmOnOff")==0)
 322   1              {//$$${AlarmOnOff:[00,00,10/21/33/12/01/1D/01]}\r\n
 323   2               //¡·´ú±í Alarm µÄ ID ºÅ 
 324   2               //¡·´ú±íÄÖÖÓµÄ¿ª¹Ø
 325   2               //¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ð°´ÕÕÊ®Áù½øÖÆÊý¼ÓÐ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ÐÇÆÚ£©
 326   2               //      ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëÐÇÆÚ¶þ ÄÇÃ´¸ñÊ½ÊÇ  0a/20/00/12/01/01/02
 327   2               //(WIFI_CMD[11]-'0')  //ProgrammaµÄIDºÅÔÝÊ±Ã»ÓÐ£¬ÎªÒÔºóÀ©Õ¹Ô¤±¸   
 328   2                      alarm.Enable=(WIFI_CMD[17]-'0'); 
 329   2                      IE3 &= ~0x04;           // Enable WT interrupt
 330   2                      gRTC_Hour    =char_to_hex(WIFI_CMD[19],WIFI_CMD[20]);
 331   2                      gRTC_Minute  =char_to_hex(WIFI_CMD[22],WIFI_CMD[23]);
 332   2                      gRTC_Sec     =char_to_hex(WIFI_CMD[25],WIFI_CMD[26]);
 333   2                      gRTC_Week    =WIFI_CMD[38]-'0';
 334   2                      gRTC_Week=Week_Table[gRTC_Week];
 335   2                      IE3 |= 0x04;            // Enable WT interrupt
 336   2                      if((alarm.Enable)&&(!(alarm.Week&0x7F)))
 337   2                       Flag_alarm_wake_only=1;
 338   2                      else
 339   2                       Flag_alarm_wake_only=0;
 340   2              }
 341   1                      else if(char_compare(WIFI_CMD, "Turn on unit")==0) 
 342   1                      {//$$$Turn on unit\r\n
 343   2                              Uart0Transmit_SendString(Uart0_Receive);
 344   2                              if(PlayMode==PLAY_OFF)
 345   2                              {
 346   3                                      GP389_ON();     
 347   3                                      //ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 348   3                                      return;
 349   3                              }
 350   2                      }
 351   1                      else if(char_compare(WIFI_CMD, "Turn on Lightr")==0)
 352   1                      {//$$$Turn on Lightr\r\n
 353   2                              Uart0Transmit_SendString(Uart0_Receive);
 354   2                              if(PlayMode==PLAY_OFF)
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 7   

 355   2                                      GP389_ON_APP(); 
 356   2                              if(alarm.Runing)//Õâ¸öÒ»¶¨ÊÇ¿ª»ú×´Ì¬²Å½øÈ¥
 357   2                              {
 358   3                                      alarm.Runing=0;
 359   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 360   3                              }
 361   2                              color_mode=color_mode_bk;
 362   2                              if(color_mode==COLOR_OFF)
 363   2                                      color_mode=COLOR_WHITE;
 364   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 365   2                              return;
 366   2                      }
 367   1                      else if(char_compare(WIFI_CMD, "Change light color")==0)  
 368   1                      {//$$$Change light color Allplay\r\n
 369   2                              Uart0Transmit_SendString(Uart0_Receive);
 370   2                              if(PlayMode==PLAY_OFF)
 371   2                                      GP389_ON_APP();
 372   2                              if(alarm.Runing)
 373   2                              {//Õâ¸öÒ»¶¨ÊÇ¿ª»úÇé¿öÏÂ½øÈëµÄ
 374   3                                      alarm.Runing=0;
 375   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 376   3                              }
 377   2                              color_mode=COLOR_CHANGE;
 378   2                              play_rgb_index=0;
 379   2                              curR_val=0;
 380   2                              curG_val=0;
 381   2                              curB_val=0;
 382   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 383   2                              return;
 384   2                      } 
 385   1                      else if(char_compare(WIFI_CMD, "User color")==0) 
 386   1                      {//$$$User color FFFFFF\r\n(000000-FFFFFF)
 387   2                              Uart0Transmit_SendString(Uart0_Receive);
 388   2                              if(PlayMode==PLAY_OFF)
 389   2                                      GP389_ON_APP();
 390   2                              if(alarm.Runing)
 391   2                              {
 392   3                                      alarm.Runing=0;
 393   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 394   3                              }
 395   2                              userR_val=char_to_hex(WIFI_CMD[11],WIFI_CMD[12]);
 396   2                              userG_val=char_to_hex(WIFI_CMD[13],WIFI_CMD[14]);
 397   2                              userB_val=char_to_hex(WIFI_CMD[15],WIFI_CMD[16]);
 398   2                              color_mode=COLOR_USER;
 399   2                              Light_Brightness=((Light_Brightness==0)?1:Light_Brightness);
 400   2                              return;
 401   2                      }
 402   1                      else if(char_compare(WIFI_CMD, "Select Sound file")==0) 
 403   1                      {//$$$Select Sound file to play01\r\n
 404   2                              Uart0Transmit_SendString(Uart0_Receive);
 405   2                              if(PlayMode==PLAY_OFF)
 406   2                                      GP389_ON_APP();
 407   2                              if(alarm.Runing)
 408   2                              {
 409   3                                      alarm.Runing=0;
 410   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 411   3                              }
 412   2                              enableMute=0;//½âmute
 413   2                              enable_SPApause=0;
 414   2                              PlayMode=PLAY_MUSIC;
 415   2                              spa_name=WIFI_CMD[26]-'0';
 416   2                              if(cur_spa_name==spa_name)
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 8   

 417   2                                      spa_cmd=SPA_PALY;
 418   2                              Uart0_SendString_3Step=1;
 419   2                              Uart0Transmit_SendString(&SPASongs_Num_Table[spa_name][0]);//Ã¿´Î¸ü¸ÄÒôÀÖ¾Í·¢¸øappÍ¬²½
 420   2                              return;
 421   2                      }
 422   1                      else if(char_compare(WIFI_CMD, "music play")==0)
 423   1                      {//$$$music play\r\n
 424   2                              //Uart0Transmit_SendString(Uart0_Receive);
 425   2                              if(PlayMode==PLAY_OFF)
 426   2                                      GP389_ON_APP();
 427   2                              if(alarm.Runing)
 428   2                              {
 429   3                                      alarm.Runing=0;
 430   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 431   3                              }
 432   2                              PlayMode=PLAY_MUSIC;
 433   2                              enableMute=0;     //½â³ý¾²Òô
 434   2                              enable_SPApause=0;//Îª0±íÊ¾²¥·Å
 435   2                              if(spa_name==SPA_NONE) //spa_nameÎªÃ¶¾Ù±äÁ¿ÀàÐÍ£¬SPA_WHITENOISEÎªÃ¶¾Ù±äÁ¿ÔªËØ
 436   2                                      spa_name=SPA_BRAHM_LULLABY;
 437   2                              else
 438   2                                      spa_cmd=SPA_PALY;                       
 439   2                              /*if(PlayMode==PLAY_BT)
 440   2                              {
 441   2                                      if(flag_bt_play)
 442   2                                      {
 443   2                                              bt_cmd=BT_PALY;//Ð­ÒéÀïÃæÊÇÒ»ÌõÃüÁî£¬ËùÒÔ²¥·Å/ÔÝÍ£¶¼Òª·¢ËÍÕâÌõ
 444   2                                      }
 445   2                              }*/
 446   2                              return;
 447   2                      }
 448   1                      else if(char_compare(WIFI_CMD,"ProPlay\r\n")==0)//½ÓÊÕµ½¾Í²¥·Å×îºóµÄ½ÓÊÕµ½µÄ$$${Program:[00,01,01,00,FFF
             -FFF,03,0A,00,1E]}\r\nÊý¾Ý
 449   1                      {//$$${Program
 450   2                              Uart0Transmit_SendString(Uart0_Receive);
 451   2                              if(PlayMode==PLAY_OFF)
 452   2                                      GP389_ON_APP();
 453   2                              if(alarm.Runing)
 454   2                              {
 455   3                                      alarm.Runing=0;
 456   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 457   3                              }
 458   2                              spa_name=program1.spa_name;
 459   2                              color_mode=program1.color_mode;
 460   2                              userR_val=program1.userR_val;
 461   2                              userG_val=program1.userG_val;
 462   2                              userB_val=program1.userB_val;
 463   2                              Light_Brightness=program1.Light_Brightness;
 464   2                              sys_volume=program1.sys_volume;
 465   2                              PlayMode=program1.PlayMode;
 466   2                              enable_SPApause=program1.enable_SPApause;
 467   2                              program1.enableMute=enableMute=((enable_SPApause==0)?0:1);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔ
             -ÊÐí²¥·Å¾Í²¥·Å
 468   2                              spa_cmd=((enable_SPApause==0)?SPA_PALY:SPA_PAUSE);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔÊÐí²¥·Å¾
             -Í²¥·Å
 469   2                              TimerMode=program1.TimerMode;
 470   2                              return;
 471   2                      } 
 472   1                      else if(char_compare(WIFI_CMD,"{Program")==0)//¹Ø»ú×´Ì¬ÏÂ´ò¿ª
 473   1                      {//$$${Program:[00,01,01,00,FFFFFF,03,0A,00,1E]}\r\n
 474   2                              Uart0Transmit_SendString(Uart0_Receive);
 475   2                              if(PlayMode==PLAY_OFF)
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 9   

 476   2                                      GP389_ON_APP();
 477   2                              if(alarm.Runing)
 478   2                              {
 479   3                                      alarm.Runing=0;
 480   3                                      TimerMode=cntTimer=alarm.cntTimer=TIMER_OFF; 
 481   3                              }
 482   2                              Program1_LaterNum(); //ÏÈ°ÑµÍÊý×Ö¸³¸ø¸ßÊý×Ö£¬
 483   2                              program1.spa_name=spa_name=WIFI_CMD[14]-'0';
 484   2                              program1.color_mode=color_mode=((WIFI_CMD[17]=='1')?COLOR_WHITE:COLOR_OFF);//µÆ¹âµÄ¿ª¹Ø
 485   2                              program1.color_mode=color_mode=((WIFI_CMD[17]=='1')?((WIFI_CMD[20]=='1')?COLOR_CHANGE:COLOR_USER):COLOR
             -_OFF);//ÏÈÅÐ¶ÏÉÏÒ»×éÊÇ·ñ¿ªÆôµÆ¹â£¬Èç¹û¿ªÆôµÆ¹â¾ÍÔÙÅÐ¶ÏÊÇ·ñ¿ªÆô²ÊµÆ£¬Èç¹û²»¿ªÆô¾ÍÊÇÓÃ»§Öµ                                                                                                                                                                                                 //ÓÃ»
             -§ÖµÊÇÏÂÃæRGBµÄÖµ
 486   2                              program1.userR_val=userR_val=char_to_hex(WIFI_CMD[22],WIFI_CMD[23]);
 487   2                              program1.userG_val=userG_val=char_to_hex(WIFI_CMD[24],WIFI_CMD[25]);
 488   2                              program1.userB_val=userB_val=char_to_hex(WIFI_CMD[26],WIFI_CMD[27]);
 489   2                              program1.Light_Brightness=Light_Brightness=char_to_bcd(WIFI_CMD[29],WIFI_CMD[30]);
 490   2                              program1.sys_volume=sys_volume=char_to_hex(WIFI_CMD[32],WIFI_CMD[33]);//ÒôÁ¿
 491   2                              program1.PlayMode=PlayMode=PLAY_MUSIC;
 492   2                              program1.enable_SPApause=enable_SPApause=WIFI_CMD[36]-'0';
 493   2                              program1.enableMute=enableMute=((enable_SPApause==0)?0:1);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔ
             -ÊÐí²¥·Å¾Í²¥·Å
 494   2                              spa_cmd=((enable_SPApause==0)?SPA_PALY:SPA_PAUSE);//ÎÞÂÛÖ®Ç°²¥·Å»¹ÊÇÔÝÍ££¬Ö»ÒªÄÖÖÓÏìÓ¦²¢ÇÒÄÖÖÓÔÊÐí²¥·Å¾
             -Í²¥·Å
 495   2                              program1.TimerMode=TimerMode=cntTimer=char_to_hex(WIFI_CMD[38],WIFI_CMD[39]);
 496   2                              return;
 497   2                      }
 498   1                      else if(char_compare(WIFI_CMD,"VER0.\r\n")==0) 
 499   1                      {
 500   2                              return;
 501   2                      }
 502   1                      else if(char_compare(WIFI_CMD,"VER\r\n")==0) 
 503   1                      {
 504   2                              Uart0Transmit_SendString(MCU_VER);//Ã¿´ÎÉý¼¶ÐèÒªÊÖ¶¯¸ÄÐ´ÕâÀï
 505   2                              return;
 506   2                      }
 507   1                      else if(char_compare(WIFI_CMD,"GpSta")==0)
 508   1                      {//×îÖÕ×´Ì¬ÊÇ¹Ø»ú
 509   2                              Uart0_SendString_3Step=0;
 510   2                              cntFlag_ON_OFF=0;
 511   2                              return;//PlayMode=PLAY_OFF;     ÒòÎªÓÐÇ¿ÖÆ¹Ø»ú£¬ËùÒÔ¿ÉÒÔ²»ÒªGP389_OFF()/GP389_ON()
 512   2                      }
 513   1      //              else if(char_compare(WIFI_CMD,"GpSta:[00]\r\n")==0)
 514   1      //              {//×îÖÕ×´Ì¬ÊÇ¿ª»ú£¬
 515   1      //                      Uart0_SendString_3Step=0;
 516   1      //                      cntFlag_ON_OFF=0;
 517   1      //                      return;//PlayMode=PLAY_OFF;     ÒòÎªÓÐÇ¿ÖÆ¹Ø»ú£¬ËùÒÔ¿ÉÒÔ²»ÒªGP389_OFF()/GP389_ON()
 518   1      //              }
 519   1              
 520   1              
 521   1              if(PlayMode!=PLAY_OFF)
 522   1              {
 523   2                      if(char_compare(WIFI_CMD,"{TimeSync")==0)
 524   2                      {//$$${TimeSync:[0A/20/00/12/01/01/02]}\r\n
 525   3                              IE3 &= ~0x04;           // Enable WT interrupt
 526   3                              gRTC_Hour  =char_to_hex(WIFI_CMD[11],WIFI_CMD[12]);
 527   3                              gRTC_Minute=char_to_hex(WIFI_CMD[14],WIFI_CMD[15]);
 528   3                              gRTC_Sec   =char_to_hex(WIFI_CMD[17],WIFI_CMD[18]);
 529   3                              gRTC_Week  =WIFI_CMD[30]-'0';
 530   3                              gRTC_Week  =Week_Table[gRTC_Week];
 531   3                              IE3 |= 0x04;            // Enable WT interrupt
 532   3                              Falg_TimeSync_Allow=0;//½ÓÊÕµ½Í¬²½ÐÅÏ¢¾Í²»ÔÙ·¢ËÍÇëÇóÍ¬²½£¬ËùÒÔÖÃÎª0
 533   3                              return;
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 10  

 534   3                      }       
 535   2                      else if(char_compare(WIFI_CMD, "Turn off unit")==0) 
 536   2                      {//ÕâÌõÐ­ÒéÃüÁîÊÇappÖ±½Ó·¢ËÍ¹ýÀ´µÄ¹Ø»úÃüÁî£¬²»ÓÃÉêÇë¾Í¿ÉÒÔ¹Ø»ú£¬µ«ÊÇÊÕµ½ÕâÌõÃüÁîÒªÅÐ¶Ï
 537   3                       //´ËÊ±²»ÓÃ½øÐÐÅÐ¶ÏÊÇ²»ÊÇÔÚ¹Ø»ú×´Ì¬£¬ÒòÎª¹Ø»úÖ®ºóÐèÒªÉè¶¨µÄ×´Ì¬¶Ô³ÌÐòÎÞÓ°Ïì£¬»òÕß¿ª»úÖ®
 538   3                       //ºó»á³õÊ¼»¯ÕâÐ©×´Ì¬
 539   3                       //$$$Turn off unit\r\n
 540   3                              Uart0Transmit_SendString(Uart0_Receive);
 541   3                              if(alarm.Runing)
 542   3                              {
 543   4                                      GP389_OFF_AND_AlarmOFF();
 544   4                                      return;
 545   4                              }
 546   3                              
 547   3                              Uart0_SendString_3Step=3;
 548   3                              GP389_OFF();
 549   3                              //ApplicationGP389_ONOFF((PlayMode==PLAY_OFF)?1:0);
 550   3                              return;
 551   3                      }
 552   2                      else if(char_compare(WIFI_CMD, "Turn on BT")==0) 
 553   2                      {//$$$Turn on BT\r\n
 554   3                              PlayMode=PLAY_BT;
 555   3                      }
 556   2                      else if(char_compare(WIFI_CMD, "music pause")==0)
 557   2                      {//$$$music pause\r\n
 558   3                              if(PlayMode==PLAY_MUSIC)
 559   3                              {                                   
 560   4                                      enable_SPApause=1;
 561   4                                      spa_cmd=SPA_PAUSE;
 562   4                              }
 563   3      //                      if(PlayMode==PLAY_BT)
 564   3      //                      {
 565   3      //                              if(flag_bt_play) 
 566   3      //                              {
 567   3      //                                      bt_cmd=BT_PAUSE;//Ð­ÒéÀïÃæÊÇÒ»ÌõÃüÁî£¬ËùÒÔ²¥·Å/ÔÝÍ£¶¼Òª·¢ËÍÕâÌõ
 568   3      //                              }
 569   3      //                      }
 570   3                              return;
 571   3                      }
 572   2                      else if(char_compare(WIFI_CMD,"{MusicStatus")==0)
 573   2                      {
 574   3                              return;
 575   3                      }
 576   2                      else if(char_compare(WIFI_CMD, "Adjust Output Volume")==0)
 577   2                      {//$$$Adjust Output Volume01\r\n
 578   3                              if(alarm.Runing)
 579   3                              {
 580   4                                      GP389_OFF_AND_AlarmOFF();
 581   4                                      return;
 582   4                              }
 583   3                              sys_volume=char_to_bcd(WIFI_CMD[20],WIFI_CMD[21]);
 584   3                              enableMute=0;
 585   3                      }
 586   2                      else if(char_compare(WIFI_CMD, "volume up")==0) 
 587   2                      {//$$$volume up\r\n
 588   3                              if(alarm.Runing)
 589   3                              {
 590   4                                      GP389_OFF_AND_AlarmOFF();
 591   4                                      return;
 592   4                              }
 593   3                              sys_volume=((sys_volume < 10)?((sys_volume<=8)?(sys_volume += 2):(sys_volume += 1)):10);
 594   3                              enableMute=0;
 595   3                      }
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 11  

 596   2                      else if(char_compare(WIFI_CMD, "volume down")==0) 
 597   2                      {//volume down\r\n
 598   3                              if(alarm.Runing)
 599   3                              {
 600   4                                      GP389_OFF_AND_AlarmOFF();
 601   4                                      return;
 602   4                              }
 603   3                              sys_volume=((sys_volume > 1)?((sys_volume>=3)?(sys_volume -= 2):(sys_volume -= 1)):1);
 604   3                              enableMute=0;
 605   3                      }
 606   2                      else if(char_compare(WIFI_CMD, "music mute")==0) 
 607   2                      {//$$$music mute\r\n
 608   3                              enableMute=1;
 609   3                              return;
 610   3                      }
 611   2                      else if(char_compare(WIFI_CMD, "music unmute")==0) 
 612   2                      {//$$$music unmute\r\n
 613   3                              enableMute=0;
 614   3                              return;
 615   3                      }
 616   2                      else if(char_compare(WIFI_CMD, "Set Timer")==0)//ok
 617   2                      {//$$$Set Timer 15\r\n(15/30/60)
 618   3                              if(alarm.Runing)
 619   3                              {
 620   4                                      GP389_OFF_AND_AlarmOFF();
 621   4                                      return;
 622   4                              }
 623   3                              TimerMode=cntTimer=char_to_bcd(WIFI_CMD[10],WIFI_CMD[11]);
 624   3                      }
 625   2                      else if(char_compare(WIFI_CMD, "Turn off Timer")==0)//ok
 626   2                      {//$$$Turn off Timer\r\n
 627   3                              if(alarm.Runing)
 628   3                              {
 629   4                                      GP389_OFF_AND_AlarmOFF();
 630   4                                      return;
 631   4                              }
 632   3                              TimerMode=cntTimer=TIMER_OFF;
 633   3                      }
 634   2                      else if(char_compare(WIFI_CMD, "Turn off Lightr")==0)  
 635   2                      {//$$$Turn off Lightr\r\n
 636   3                              if(alarm.Runing)
 637   3                              {
 638   4                                      GP389_OFF_AND_AlarmOFF();
 639   4                                      return;
 640   4                              }
 641   3                              color_mode=COLOR_OFF;
 642   3                      } 
 643   2                      else if(char_compare(WIFI_CMD,"light up")==0)
 644   2                      {//$$$light up\r\n
 645   3                              if(alarm.Runing)
 646   3                              {
 647   4                                      GP389_OFF_AND_AlarmOFF();
 648   4                                      return;
 649   4                              }
 650   3                              if(Light_Brightness<3)
 651   3                                      Light_Brightness++;
 652   3                      }
 653   2                      else if(char_compare(WIFI_CMD,"light down")==0)
 654   2                      {//$$$light down\r\n
 655   3                              if(alarm.Runing)
 656   3                              {
 657   4                                      GP389_OFF_AND_AlarmOFF();
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 12  

 658   4                                      return;
 659   4                              }
 660   3                              if(Light_Brightness>0)
 661   3                                      Light_Brightness--;
 662   3                      }
 663   2                      else if(char_compare(WIFI_CMD,"Adjust Light Brightness")==0)
 664   2                      {//$$$Adjust Light Brightness 01\r\n(01-03)
 665   3                              if(alarm.Runing)
 666   3                              {
 667   4                                      GP389_OFF_AND_AlarmOFF();
 668   4                                      return;
 669   4                              }
 670   3                              Light_Brightness=char_to_bcd(WIFI_CMD[24],WIFI_CMD[25]);
 671   3                      }
 672   2                      else if(char_compare(WIFI_CMD,"AlaGpSta\r\n")==0) 
 673   2                      {//W-G:"$$$AlaGpSta\r\n"
 674   3                       //G-W:"$$${AlaGpSta:[00,01,01,00,FFFFFF,03,0A,00,01,FF,17:3B,FF]}\r\n"
 675   3                       //Êý×éÖÐµÚÊý¾ÝÒÔ¶ººÅ·Ö¸ô£¬Êý×ÖÒÔ 16 ½øÖÆ±íÊ¾£¨ÕâÀï²»Ð´"0x"£©£¬´Ó×óµ½ÓÒÒÀ´ÎÃ¿¸ö×Ö¶Î£¨13¸ö×Ö¶Î£©·Ö±ð±íÊ¾£
             -º
 676   3                       //¡·´ú±í Alarm µÄ ID ºÅ £¨×¢£ºÏÖÔÚÖ»ÓÐÒ»¸öÄÖÖÓ£¬Ä¬ÈÏÎª0£©
 677   3                       //¡·´ú±íµÚ¼¸Ê×¸è£¨01 - 06£©
 678   3                       //¡·´ú±í¿ª¹ØµÆ£¨00¹Ø 01¿ª£©
 679   3                       //¡·´ú±íÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨00 ¹Ø 01 ¿ª£©£¨×¢£º²ÊµÆÑ­»·£¬Îª1¿ªÆôÑ­»·£©
 680   3                       //¡·´ú±íµÆµÄRGBÖµ£¨000000 - FFFFFF£©£¨²ÊµÆÑ­»·Õâ¸öÖµÎª000000£©
 681   3                       //¡·´ú±íÁÁ¶È( 00 - 03 )
 682   3                       //¡·´ú±íÒôÁ¿Öµ ( 00 - 0a )
 683   3                       //¡·´ú±íÔÝÍ£pauseÑ¡Ôñ£¨00±íÊ¾Õý³£²¥·Å,01±íÊ¾ÔÝÍ£²¥·Å£©
 684   3                       //£¨È¥µô£©¡·´ú±í¶¨Ê±Æ÷£¬00(¹Ø/²»¿ªÆô¶¨Ê±)£¬0F(15min)£¬1E(30min)£¬3C(60min)   
 685   3                       //¡·´ú±íÄÖÖÓ×Ü¿ª¹Ø£¨00 ¹Ø 01: ¿ª£©£¨Ä¬ÈÏ0£©
 686   3                       //¡·´ú±íÖÜÒ»µ½ÖÜÈÕµÄ¿ª¹Ø£¬Ã¿Ò»ÌìÓÃÒ»¸ö bit ±íÊ¾
 687   3                       //    0x80 ´ú±íÊÇ·ñÖØ¸´ÄÖÁå
 688   3                       //    0x01 ´ú±íÖÜÒ»Æô¶¯ÄÖÁå£¬µ«ÊÇÖ»ÏìÒ»´Î£¬ÕâÒ»´ÎÊÇÆßÌìÖ®ÄÚµÄ£¬
 689   3                       //    0xFF ´ú±íÄÖÁåÈ«¿ª£¬²¢ÇÒÃ¿ÖÜÖØ¸´£¬ÒÔ´ËÀàÍÆ
 690   3                       //    BIT            7       6    5    4    3    2    1    0
 691   3                       //    ÐÇÆÚx   repeat  ÈÕ  Áù  Îå  ËÄ  Èý  ¶þ  Ò»  £¨×¢£ºrepeatÎªÃ¿ÖÜ¶¼ÖØ¸´ÄÖÁå£¬·ñÔòÖ»ÏìÒ»´Î£¬ÕâÒ»´Î
 692   3                       //  ÊÇÆßÌìÖ®ÄÚµÄ£¬¼ÙÈç¶¨Ê±13:00£¬²»ÖØ¸´£¬ÄÇÕâ´Î¼ÆÊ±µ½(7*24*60-1)minÖ®ºó½áÊø£¬¼´ÆßÌìÖ®ºó
 693   3                       //  µÄ12:59·Ö£©
 694   3                       //¡·´ú±íÄÖÖÓ¶¨Ê±Ê±¼äµã£¨17:3B£©(¶¼ÊÇ16½øÖÆ,:×ó±ßÊÇÄÖÖÓµÄÊ±£¬·¶Î§ÊÇ00-17; :ÓÒ±ßÊÇÄÖÖÓµÄ·Ö£¬·¶Î§ÊÇ00-3B)
 695   3                       //¡·´ú±íÏìÁåÊ±¼ä£¨charÀàÐÍ1¸ö×Ö½Ú£©00-FF (µ¥Î»:·ÖÖÓ)
 696   3                       //£¨È¥µô£©¡·´ú±íµ±Ç°Ê±¼ä´Á£¬·Ö±ð°´ÕÕÊ®Áù½øÖÆÊý¼ÓÐ±¸Ü±íÊ¾£¬¸ñÊ½ÈçÏÂ£º£¨Ê±/·Ö/Ãë/Äê/ÔÂ/ÈÕ/ÐÇÆÚ£© 
 697   3                       //    ±ÈÈç 2018 Äê 1 ÔÂ 1 ÈÕ 10 Ê± 32 ·Ö 0 ÃëÐÇÆÚ¶þ ÄÇÃ´¸ñÊ½ÊÇ 0a/20/00/12/01/01/02
 698   3                              char  code respAlaGpSta[]={"$$${AlaGpSta:[00,00,00,00,000000,00,00,00,00,00,00:00,00]}\r\n"};
 699   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 700   3                                      Uart0_Receive[i]=0x00;
 701   3                              for(i=0;i<62;i++)
 702   3                                      Uart0_Receive[i]=respAlaGpSta[i];
 703   3                              hex_to_char(&Uart0_Receive[14],0);//IDºÅÄ¬ÈÏÎª0
 704   3                              hex_to_char(&Uart0_Receive[17],((alarm.spa_name!=0)?alarm.spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ
             -£¬ÊÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 705   3                              hex_to_char(&Uart0_Receive[20],((alarm.color_mode==COLOR_OFF)?0:1));//¿ª¹ØµÆ
 706   3                              hex_to_char(&Uart0_Receive[23],(((alarm.color_mode==COLOR_CHANGE)?1:0)));//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½
             -£©
 707   3                              hex_to_char(&Uart0_Receive[26],alarm.userR_val);
 708   3                              hex_to_char(&Uart0_Receive[28],alarm.userG_val);
 709   3                              hex_to_char(&Uart0_Receive[30],alarm.userB_val);
 710   3                              hex_to_char(&Uart0_Receive[33],alarm.Brightness);//ÁÁ¶È
 711   3                              hex_to_char(&Uart0_Receive[36],alarm.volume);//ÒôÁ¿
 712   3                              hex_to_char(&Uart0_Receive[39],alarm.play_pause);
 713   3                              hex_to_char(&Uart0_Receive[42],alarm.Enable);
 714   3                              hex_to_char(&Uart0_Receive[45],alarm.Week);
 715   3                              hex_to_char(&Uart0_Receive[48],alarm.Hour);
 716   3                              hex_to_char(&Uart0_Receive[51],alarm.Minute);
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 13  

 717   3                              hex_to_char(&Uart0_Receive[54],alarm.Duration);
 718   3                              Uart0_SendString_3Step=2;
 719   3                      }
 720   2                      else if(char_compare(WIFI_CMD,"NorGpSta\r\n")==0)
 721   2                      {//W-G:"$$$NorGpSta\r\n"
 722   3                       //G-W:"$$${NorGpSta:[00,00,01,01,FFFFFF,03,0A,00,1E]}\r\n"
 723   3                              char  code respNorGpSta[]={"$$${NorGpSta:[00,00,00,00,000000,00,00,00,00]}\r\n"};
 724   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 725   3                                      Uart0_Receive[i]=0x00;
 726   3                              for(i=0;i<48;i++)
 727   3                                      Uart0_Receive[i]=respNorGpSta[i];
 728   3                              hex_to_char(&Uart0_Receive[14],1);//ÔÚÕâÀïÊÇ¿ª»ú
 729   3                              hex_to_char(&Uart0_Receive[17],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬Ê
             -ÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 730   3                              hex_to_char(&Uart0_Receive[20],(color_mode==COLOR_OFF)?0:1);
 731   3                              hex_to_char(&Uart0_Receive[23],(color_mode==COLOR_CHANGE)?0:1);//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½£©
 732   3                              hex_to_char(&Uart0_Receive[26],userR_val);
 733   3                              hex_to_char(&Uart0_Receive[28],userG_val);
 734   3                              hex_to_char(&Uart0_Receive[30],userB_val);
 735   3                              hex_to_char(&Uart0_Receive[33],Light_Brightness);
 736   3                              hex_to_char(&Uart0_Receive[36],sys_volume);
 737   3                              hex_to_char(&Uart0_Receive[39],enable_SPApause);
 738   3                              hex_to_char(&Uart0_Receive[42],cntTimer);
 739   3                              Uart0_SendString_3Step=2;
 740   3                      }
 741   2                      else if(char_compare(WIFI_CMD," update")==0) 
 742   2                      {//mcu update+0X43A4+0X0044,½ÓÊÕµ½Õâ¸öÐÅÏ¢¿ªÊ¼Éý¼¶
 743   3                              Update_ByteSizeSum=(char_to_hex(WIFI_CMD[10],WIFI_CMD[11])<<8)|char_to_hex(WIFI_CMD[12],WIFI_CMD[13]);/
             -/¶àÉÙ¸ö×Ö½Ú£¬µØÎ»ÔÚÇ°£¬¸ßÎ»ÔÚºó
 744   3                              Update_PacketSum  =(char_to_hex(WIFI_CMD[17],WIFI_CMD[18])<<8)|char_to_hex(WIFI_CMD[19],WIFI_CMD[20]);/
             -/¶àÉÙ¸ö°ü
 745   3                              update_handle();
 746   3                      }
 747   2                      else if(char_compare(WIFI_CMD,"ATWQ\r\n")==0) 
 748   2                      {//$$$ATWQ\r\n
 749   3                              Uart0_SendString_3Step=0;
 750   3                              return;
 751   3                      }
 752   2                      else if(char_compare(WIFI_CMD,"VER\r\n")==0) 
 753   2                      {
 754   3                              Uart0Transmit_SendString(MCU_VER);//Ã¿´ÎÉý¼¶ÐèÒªÊÖ¶¯¸ÄÐ´ÕâÀï
 755   3                              return;
 756   3                      }
 757   2                      else if(char_compare(WIFI_CMD,"Enter TestMode:")==0) 
 758   2                      {
 759   3                              Uart0_SendString_3Step=0;
 760   3                              cntFlash=0;
 761   3                              Led_Flash=0;
 762   3                              setFactory=1;//ÖÃÒ»ÈÃÈý¸ötimerµÆ³£ÁÁÈýÃë
 763   3                              PlayMode=PLAY_ON;
 764   3                              bt_send_cmd(BT_CLEAR_LIST);//Çå³ýÀ¶ÑÀÁÐ±íÁÐ±í
 765   3                              return;
 766   3                      }
 767   2                      Uart0Transmit_SendString(Uart0_Receive);
 768   2                      ////////////////////////////////////////////////////////////////////////////////////
 769   2                      ////////////////////////////////////////////////////////////////////////////////////
 770   2              }
 771   1              else //¹Ø»ú×´Ì¬ÏÂ½ÓÊÕÌØ¶¨wifiÊý¾Ý
 772   1              {
 773   2                      if(char_compare(WIFI_CMD,"{NorGpSta")==0)
 774   2                      {//W-G:"$$$NorGpSta\r\n"
 775   3                       //G-W:"$$${NorGpSta:[00,00,01,01,FFFFFF,03,0A,00,1E]}\r\n"
C51 COMPILER V9.00   WIFI_MODE                                                             08/07/2018 12:04:31 PAGE 14  

 776   3                              char  code respNorGpSta[]={"$$${NorGpSta:[00,00,00,00,000000,00,00,00,00]}\r\n"};
 777   3                              for(i=0;i<UART0_LEN_BUFFER;i++)
 778   3                                      Uart0_Receive[i]=0x00;
 779   3                              for(i=0;i<48;i++)
 780   3                                      Uart0_Receive[i]=respNorGpSta[i];
 781   3                              hex_to_char(&Uart0_Receive[14],0);//ÔÚÕâÀïÊÇ¿ª»ú
 782   3                              hex_to_char(&Uart0_Receive[17],((PlayMode==PLAY_MUSIC)?spa_name:7));//Ê×ÏÈÅÐ¶ÏÊÇ²»ÊÇÒôÀÖÄ£Ê½£¬Èç¹ûÊÇ£¬Ê
             -ÇµÚ¼¸Ê×¸è£¬Èç¹û²»ÊÇ¾Í·µ»ØÔÝÍ££¬7
 783   3                              hex_to_char(&Uart0_Receive[20],(color_mode==COLOR_OFF)?0:1);
 784   3                              hex_to_char(&Uart0_Receive[23],(color_mode==COLOR_CHANGE)?0:1);//ÊÇ·ñÊÇ²ÊµÆÄ£Ê½£¨Ñ­»·½¥±äÄ£Ê½£©
 785   3                              hex_to_char(&Uart0_Receive[26],userR_val);
 786   3                              hex_to_char(&Uart0_Receive[28],userG_val);
 787   3                              hex_to_char(&Uart0_Receive[30],userB_val);
 788   3                              hex_to_char(&Uart0_Receive[33],Light_Brightness);
 789   3                              hex_to_char(&Uart0_Receive[36],sys_volume);
 790   3                              hex_to_char(&Uart0_Receive[39],enable_SPApause);
 791   3                              hex_to_char(&Uart0_Receive[42],cntTimer);
 792   3                              Uart0_SendString_3Step=2;
 793   3                      }
 794   2                      Uart0Transmit_SendString(Uart0_Receive);
 795   2              }
 796   1      }
 797          
 798          /*******************************************************************
 799          º¯ÊýÔ­ÐÍ£º
 800          ÊäÈë²ÎÊý£º
 801          Êä³ö²ÎÊý£º
 802          º¯Êý¹¦ÄÜ£ºÔÚappÉÏ·¢ËÍ¡°×´Ì¬¡°¹¦ÄÜ¸ø»úÌ¨£¬×´Ì¬¹¦ÄÜÊÇÍ¬Ê±ÉèÖÃºÃ¼¸¸ö²Ù×÷£¨ÒôÀÖ£¬µÆ¹âµÈ£©£¬È»ºóÒ»Æð·¢¹ýÀ´
 803                    È»ºó»úÌ¨¼ÇÂ¼ÏÂÀ´µÚ¼¸´Î·¢µÄ£¬°ÑÐÂµÄÒ»´Î¸´ÖÆ¸øprogram1£¬ÉÏÒ»´ÎµÄprogram1¸´ÖÆ¸øprogram2£¬ÒòÎª
 804                            Êý¾ÝºÍÊý¾ÝÀàÐÍ¶¼Ò»Ñù£¬ËùÒÔ¿ÉÒÔÖ±½Ó¸´ÖÆ
 805          *******************************************************************/
 806          void Program1_LaterNum()
 807          {
 808   1              program3=program2;//ÒòÎªÊý¾ÝºÍÊý¾ÝÀàÐÍÍêÈ«Ò»Ñù£¬ËùÒÔ¿ÉÒÔÖ±½Ó¸³Öµ
 809   1              program2=program1;
 810   1      }
 811          
 812          
 813          
 814          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5074    ----
   CONSTANT SIZE    =    855    ----
   XDATA SIZE       =   ----      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
